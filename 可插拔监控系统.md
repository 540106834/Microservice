å¥½ï¼Œæˆ‘ä»¬**çœŸçš„ä» 0 å¼€å§‹**ã€‚
ä¸å‡è®¾ä½ â€œå·²ç»æ‡‚â€ï¼Œä¹Ÿä¸å·æ­¥ã€‚ä¸€æ­¥ä¸€å—ç –ï¼Œæœ€åä½ èƒ½ **è‡ªå·±æ­å‡ºä¸€ä¸ªå¯æ’æ‹”ç›‘æ§ç³»ç»Ÿ** 

ä½ å¯ä»¥æŠŠä¸‹é¢å†…å®¹å½“æˆï¼š
ğŸ‘‰ **è¿ç»´ç‰ˆ Java é¢å‘å¯¹è±¡å…¥é—¨å®Œæ•´æ¡ˆä¾‹**

---

# 0 æˆ‘ä»¬è¦åšä»€ä¹ˆï¼ˆå…ˆå®šç›®æ ‡ï¼‰

ç›®æ ‡ä¸æ˜¯â€œå­¦æ¥å£â€ï¼Œè€Œæ˜¯åšè¿™ä¸ªä¸œè¥¿ï¼š

> ä¸€ä¸ªç¨‹åº
> èƒ½é‡‡é›†ç›‘æ§æ•°æ®
> èƒ½å­˜åˆ°ä¸åŒåç«¯
> **ä»¥åéšä¾¿åŠ ã€éšä¾¿æ¢ï¼Œä¸æ”¹æ ¸å¿ƒä»£ç **

è¿™æ­£æ˜¯è¿ç»´ä¸–ç•Œå¤©å¤©é‡åˆ°çš„é—®é¢˜ã€‚

---

# 1 ç¬¬ä¸€æ­¥ï¼šä»€ä¹ˆéƒ½ä¸æŠ½è±¡ï¼Œå…ˆå†™æœ€ç¬¨çš„ç‰ˆæœ¬ ğŸª¨

### 1.1 éœ€æ±‚

* é‡‡é›† CPU ä½¿ç”¨ç‡
* å­˜åˆ° MySQL

### 1.2 æœ€åŸå§‹å†™æ³•ï¼ˆæ²¡æœ‰æ¥å£ï¼‰

```java
public class MonitorV1 {

    public static void main(String[] args) {

        // é‡‡é›† CPU
        double cpuUsage = Math.random() * 100;

        // å­˜ MySQL
        System.out.println("å­˜å…¥ MySQLï¼šcpu = " + cpuUsage);
    }
}
```

âœ” èƒ½è·‘
âŒ é—®é¢˜å·²ç»å‡ºç°äº†

---

### 1.3 é—®é¢˜ï¼ˆéå¸¸é‡è¦ï¼‰

å¦‚æœç°åœ¨è¦ï¼š

* å†é‡‡é›† **å†…å­˜**
* æˆ–å­˜åˆ° **ES**
* æˆ–ä»¥åä¸Š **Prometheus**

ä½ åªèƒ½ï¼š
ğŸ‘‰ **ç–¯ç‹‚å¤åˆ¶ + æ”¹ä»£ç **

è¿™å°±æ˜¯â€œç¡¬ç¼–ç åœ°ç‹±â€ 

---

# 2 ç¬¬äºŒæ­¥ï¼šæŠŠâ€œé‡‡é›†â€å•ç‹¬æ‹å‡ºæ¥ï¼ˆè¿˜ä¸å¼•å…¥æ¥å£ï¼‰

### 2.1 CPU é‡‡é›†ç±»

```java
public class CpuCollector {

    public double collect() {
        return Math.random() * 100;
    }
}
```

### 2.2 ä¸»ç¨‹åº

```java
public class MonitorV2 {

    public static void main(String[] args) {

        CpuCollector cpuCollector = new CpuCollector();
        double cpu = cpuCollector.collect();

        System.out.println("å­˜å…¥ MySQLï¼šcpu = " + cpu);
    }
}
```

âœ” ç¨å¾®å¥½ä¸€ç‚¹
âŒ ä½†åªèƒ½é‡‡é›† CPU

---

# 3ï¸âƒ£ ç¬¬ä¸‰æ­¥ï¼šå¼•å…¥â€œç»Ÿä¸€æ•°æ®æ¨¡å‹â€ï¼ˆéå¸¸å…³é”®ï¼‰

### 3.1 ä¸ºä»€ä¹ˆè¦æœ‰ Metricï¼Ÿ

å› ä¸ºï¼š

* CPU æ˜¯ä¸€ä¸ªå€¼
* å†…å­˜ä¹Ÿæ˜¯ä¸€ä¸ªå€¼
* ç£ç›˜ä¹Ÿæ˜¯ä¸€ä¸ªå€¼

**ç»“æ„æ˜¯ä¸€æ ·çš„**

---

### 3.2 å®šä¹‰ Metric ç±»

```java
public class Metric {

    private String name;
    private double value;
    private long timestamp;

    public Metric(String name, double value) {
        this.name = name;
        this.value = value;
        this.timestamp = System.currentTimeMillis();
    }

    public String getName() {
        return name;
    }

    public double getValue() {
        return value;
    }

    public long getTimestamp() {
        return timestamp;
    }
}
```

ğŸ“Œ è¿™æ˜¯ç›‘æ§ç³»ç»Ÿçš„â€œé€šç”¨è¯­è¨€â€

---

# 4ï¸âƒ£ ç¬¬å››æ­¥ï¼šç¬¬ä¸€ä¸ªæ¥å£è¯ç”Ÿäº†ï¼ˆé‡‡é›†å™¨ï¼‰

## 4.1 ä¸ºä»€ä¹ˆè¦æ¥å£ï¼Ÿ

ä½ é©¬ä¸Šä¼šæœ‰ï¼š

* CPU é‡‡é›†
* å†…å­˜é‡‡é›†
* JVM é‡‡é›†
* ç£ç›˜é‡‡é›†

ğŸ‘‰ **è¡Œä¸ºä¸€æ ·ï¼Œåšæ³•ä¸åŒ**

---

### 4.2 å®šä¹‰é‡‡é›†å™¨æ¥å£

```java
public interface MetricsCollector {

    Metric collect();
}
```

æ³¨æ„ï¼š
ğŸ“Œ æ¥å£åªå®šä¹‰ **èƒ½åšä»€ä¹ˆ**

---

### 4.3 CPU é‡‡é›†å™¨å®ç°

```java
public class CpuMetricsCollector implements MetricsCollector {

    @Override
    public Metric collect() {
        double cpu = Math.random() * 100;
        return new Metric("cpu.usage", cpu);
    }
}
```

### 4.4 å†…å­˜é‡‡é›†å™¨å®ç°

```java
public class MemoryMetricsCollector implements MetricsCollector {

    @Override
    public Metric collect() {
        double mem = Math.random() * 100;
        return new Metric("memory.usage", mem);
    }
}
```

 åˆ°è¿™é‡Œä½ å·²ç»å®Œæˆäº†ï¼š

> **ç¬¬ä¸€æ¬¡çœŸæ­£çš„æ¥å£ + å¤šæ€å‡†å¤‡**

---

# 5 ç¬¬äº”æ­¥ï¼šå†æ¥ä¸€ä¸ªæ¥å£ï¼ˆå­˜å‚¨åç«¯ï¼‰

### 5.1 å®šä¹‰å­˜å‚¨æ¥å£

```java
public interface MetricsStorage {

    void save(Metric metric);
}
```

---

### 5.2 MySQL å­˜å‚¨å®ç°

```java
public class MySqlMetricsStorage implements MetricsStorage {

    @Override
    public void save(Metric metric) {
        System.out.println(
            " MySQL ä¿å­˜ï¼š" + metric.getName() + " = " + metric.getValue()
        );
    }
}
```

---

### 5.3 ES å­˜å‚¨å®ç°

```java
public class EsMetricsStorage implements MetricsStorage {

    @Override
    public void save(Metric metric) {
        System.out.println(
            " ES ä¿å­˜ï¼š" + metric.getName() + " = " + metric.getValue()
        );
    }
}
```

---

# 6ï¸âƒ£ ç¬¬å…­æ­¥ï¼šå¤šæ€æ­£å¼ç™»åœºï¼ˆæ ¸å¿ƒï¼ï¼‰

## 6.1 è°ƒåº¦å™¨ï¼ˆæ°¸è¿œä¸æ”¹çš„æ ¸å¿ƒï¼‰

```java
import java.util.List;

public class MetricsScheduler {

    private List<MetricsCollector> collectors;
    private MetricsStorage storage;

    public MetricsScheduler(List<MetricsCollector> collectors,
                            MetricsStorage storage) {
        this.collectors = collectors;
        this.storage = storage;
    }

    public void runOnce() {
        for (MetricsCollector collector : collectors) {
            Metric metric = collector.collect();
            storage.save(metric);
        }
    }
}
```

ğŸ“Œ è¿™æ®µä»£ç é‡Œï¼š

* **æ²¡æœ‰ CPU**
* **æ²¡æœ‰ MySQL**
* **åªæœ‰æ¥å£**

è¿™å°±æ˜¯æ¶æ„ç¨³å®šæ€§çš„æ¥æºã€‚

---

## 6.2 ä¸»ç¨‹åºï¼ˆè‡ªç”±ç»„åˆï¼‰

```java
import java.util.Arrays;

public class MonitorApp {

    public static void main(String[] args) {

        MetricsCollector cpu = new CpuMetricsCollector();
        MetricsCollector mem = new MemoryMetricsCollector();

        MetricsStorage storage = new EsMetricsStorage();
        // MetricsStorage storage = new MySqlMetricsStorage();

        MetricsScheduler scheduler =
            new MetricsScheduler(Arrays.asList(cpu, mem), storage);

        scheduler.runOnce();
    }
}
```

ğŸ‰ æ­å–œ
ä½ å·²ç»å†™å‡ºäº†ï¼š

> **ä¸€ä¸ªå¯æ’æ‹”çš„ç›‘æ§ç³»ç»Ÿéª¨æ¶**

---

# 7 è¿ç»´è§†è§’æ€»ç»“ï¼ˆéå¸¸é‡è¦ï¼‰

### ä½ åˆšåˆšåšäº†ä»€ä¹ˆï¼Ÿ

| è¿ç»´ç°å®          | ä½ å†™çš„ä»£ç                   |
| ------------- | ---------------------- |
| node_exporter | MetricsCollector       |
| å¤šé‡‡é›†å™¨          | List<MetricsCollector> |
| å­˜å‚¨åç«¯          | MetricsStorage         |
| åˆ‡æ¢å­˜å‚¨          | new å®ç°ç±»                |

---

### ä¸€å¥è¯è®°ä½å®ƒï¼š

> **æ¥å£è´Ÿè´£ç¨³å®šï¼Œå¤šæ€è´Ÿè´£å˜åŒ–**

---

# 8 ä¸‹ä¸€æ­¥å‡çº§è·¯çº¿ï¼ˆä½ é€‰ï¼‰

æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªâ€œ0 â†’ 1â€çš„åŸºç¡€ä¸Šç»§ç»­ï¼š

1ï¸âƒ£ åŠ  **å‘Šè­¦è§„åˆ™ + å‘Šè­¦æ¥å£**
2ï¸âƒ£ åŠ  **é…ç½®æ–‡ä»¶å†³å®šå­˜å‚¨åç«¯**
3ï¸âƒ£ æ”¹æˆ **Spring Boot è‡ªåŠ¨è£…é…**
4ï¸âƒ£ å¯¹ç…§ **Prometheus æ¶æ„é€ä¸€æ˜ å°„**

ä½ è¯´ä¸€ä¸ªç¼–å·ï¼Œæˆ‘ç»§ç»­ **ä¸€æ­¥ä¸€æ­¥å¸¦ä½ å†™**ï¼Œä¸è·³æ­¥ ğŸ› ï¸
