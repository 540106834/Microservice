好，我们直接动手造一枚**可运行的微服务镜像**。目标很朴素：

👉 用 `eclipse-temurin:17-jre` 跑你的 Spring Boot jar
👉 体积合理
👉 构建规范
👉 能上 K8s
👉 不埋雷

一步一步来，照抄都能跑。

---

#  前提条件

你需要先有：

```
target/app.jar
```

如果是 Maven：

```bash
mvn clean package
```

看到 jar 出现在 `target/`，就算点火成功 

---

#  推荐 Dockerfile（生产可用版）

直接放项目根目录。

```dockerfile
# -------- 构建阶段 --------
FROM maven:3.9.9-eclipse-temurin-17 AS builder

WORKDIR /build

# 先拷贝依赖描述，提高缓存命中
COPY pom.xml .

RUN mvn -B -q -e -C \
    -DskipTests \
    dependency:go-offline

# 再拷贝源码
COPY src ./src

RUN mvn clean package -DskipTests


# -------- 运行阶段 --------
FROM eclipse-temurin:17-jre

WORKDIR /app

COPY --from=builder /build/target/*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java","-jar","app.jar"]
```

这叫：

##  multi-stage build（多阶段构建）

最终镜像里只有：

✅ JRE
✅ jar

没有：

❌ Maven
❌ 源码
❌ 编译缓存

干净得像新雪。

---

#  开始构建镜像

进入项目目录：

```bash
docker build -t attendance-system .
```

看到：

```
Successfully built XXXXX
```

说明容器已经“装瓶”。

---

#  启动容器测试

```bash
docker run -p 8080:8080 attendance-system
```

浏览器打开：

```
http://localhost:8080
```

如果 Spring Boot 启动日志滚出来，那感觉像服务器心跳开始跳动 

---

#  强烈建议加的一点优化（很多人不知道）

##  JVM 容器内存感知

加这一行更安全：

```dockerfile
ENTRYPOINT ["java","-XX:+UseContainerSupport","-jar","app.jar"]
```

作用：

 JVM 会根据 **container limits** 自动调整堆大小。

否则可能发生：

> 容器 512MB
> JVM 以为自己有 8GB
> 然后直接 OOM 

---

#  再给你一个“更专业”的启动参数（建议收藏）

微服务常见：

```dockerfile
ENTRYPOINT ["java",
"-XX:+UseContainerSupport",
"-XX:MaxRAMPercentage=75",
"-jar",
"app.jar"]
```

意思：

 JVM 最多吃容器 75% 内存。

非常稳。

---

#  一个新手超级常见错误

千万别这样：

```
FROM eclipse-temurin:17-jdk
```

为什么？

 **JDK 比 JRE 大 200MB+**

如果你有 20 个微服务：

```
200MB × 20
= 4GB 浪费
```

集群磁盘会默默流泪。

---

# ⭐⭐⭐ 给你一个架构级建议（很值钱）

##  固化版本，不要用 latest

例如：

```
eclipse-temurin:17.0.10_7-jre
```

避免未来：

> “昨天还好好的，今天镜像炸了？”

很多生产事故就来自 latest。

---

# ⭐ 再往上一步的小技巧（高手味道）

构建时加：

```bash
docker build --pull -t attendance-system .
```

作用：

👉 强制拉最新安全补丁。

等于给镜像打疫苗 

---

如果你愿意继续升级，我可以再带你走一步**明显拉开水平差距的路线**：

👉 把镜像从 **300MB → 120MB**
👉 启动速度提升
👉 安全面提升

只用一招：

## **jlink 定制运行时**

很多工作 3 年的人都没用过，但架构师几乎标配。

要不要我带你做一个“瘦身版”镜像？
