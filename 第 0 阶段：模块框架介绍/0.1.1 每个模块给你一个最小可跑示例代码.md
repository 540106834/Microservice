éå¸¸å¥½ï¼Œè¿™ä¸€æ­¥å°±æ˜¯**æŠŠâ€œç†è§£â€å˜æˆâ€œè‚Œè‚‰è®°å¿†â€**ã€‚
ä¸‹é¢æˆ‘ç»™ä½ ä¸€å¥— **çœŸæ­£æœ€å°ã€ä½†å®Œæ•´å¯è·‘çš„ Spring Boot ç¤ºä¾‹**ï¼Œ**æ¯ä¸ªæ¨¡å—éƒ½æœ‰ä»£ç **ï¼Œä½ å¯ä»¥ç›´æ¥ç…§ç€å»ºé¡¹ç›®ã€å¤åˆ¶ã€è¿è¡Œã€‚

æˆ‘ä¼šæŒ‰ **ä¸€ä¸ªé¡¹ç›® â†’ å„æ¨¡å—æœ€å°å®ç°** çš„æ–¹å¼æ¥ï¼Œä¸æ‹†æˆç¢ç‰‡ Demoã€‚

---

# ä¸€ã€é¡¹ç›®å‰æï¼ˆä½ åªéœ€è¦è¿™äº›ï¼‰

* JDK 17ï¼ˆæˆ– 11ï¼‰
* Maven
* ä¸€ä¸ªç©º Spring Boot é¡¹ç›®

ğŸ‘‰ åŒ…åç»Ÿä¸€ç”¨ï¼š

```text
com.example.opsdemo
```

---

# äºŒã€å¯åŠ¨æ¨¡å—ï¼ˆApplicationï¼‰

 `OpsDemoApplication.java`

```java
package com.example.opsdemo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class OpsDemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(OpsDemoApplication.class, args);
    }
}
```

âœ… ä½œç”¨

* æœåŠ¡èƒ½ä¸èƒ½èµ·æ¥ï¼Œå…¨é å®ƒ
* è®¿é—® [http://localhost:8080](http://localhost:8080) æ‰æœ‰åç»­

---

# ä¸‰ã€Controller æ¨¡å—ï¼ˆæ¥å£å…¥å£ï¼‰

 `controller/HealthController.java`

```java
package com.example.opsdemo.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HealthController {

    @GetMapping("/health")
    public String health() {
        return "200 UP";
    }
}
```

âœ… éªŒè¯
æµè§ˆå™¨è®¿é—®ï¼š

```text
http://localhost:8080/health
```

è¿”å› `UP`
è¯´æ˜ **Controller â†’ DispatcherServlet â†’ Tomcat** å…¨é€šäº†ã€‚

---

# å››ã€DTO / VO / Entityï¼ˆæ•°æ®æ¨¡å‹ï¼‰

ğŸ“ `model/dto/UserDTO.java`

```java
package com.example.opsdemo.model.dto;

public class UserDTO {
    private String username;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
```

ğŸ“ `model/vo/UserVO.java`

```java
package com.example.opsdemo.model.vo;

public class UserVO {
    private String message;

    public UserVO(String message) {
        this.message = message;
    }

    public String getMessage() {
        return message;
    }
}
```

âœ… è¿ç»´ç†è§£

> DTO è¿›ï¼ŒVO å‡ºï¼Œä¸­é—´æ€ä¹ˆå˜ Service è¯´äº†ç®—ã€‚

---

# äº”ã€Service æ¨¡å—ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰

ğŸ“ `service/UserService.java`

```java
package com.example.opsdemo.service;

import com.example.opsdemo.model.dto.UserDTO;
import com.example.opsdemo.model.vo.UserVO;

public interface UserService {
    UserVO register(UserDTO user);
}
```

ğŸ“ `service/impl/UserServiceImpl.java`

```java
package com.example.opsdemo.service.impl;

import com.example.opsdemo.model.dto.UserDTO;
import com.example.opsdemo.model.vo.UserVO;
import com.example.opsdemo.service.UserService;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl implements UserService {

    @Override
    public UserVO register(UserDTO user) {
        return new UserVO("user " + user.getUsername() + " registered");
    }
}
```

âœ… è¿ç»´é‡ç‚¹

* æ…¢ä¸æ…¢ï¼Œå¤§å¤šä»è¿™é‡Œå¼€å§‹çœ‹
* è¿™é‡Œæ˜¯æœ€å¸¸åŠ æ—¥å¿—çš„åœ°æ–¹

---

# å…­ã€Controller è°ƒç”¨ Serviceï¼ˆå®Œæ•´æ¥å£ï¼‰

ğŸ“ `controller/UserController.java`

```java
package com.example.opsdemo.controller;

import com.example.opsdemo.model.dto.UserDTO;
import com.example.opsdemo.model.vo.UserVO;
import com.example.opsdemo.service.UserService;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/users")
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @PostMapping("/register")
    public UserVO register(@RequestBody UserDTO user) {
        return userService.register(user);
    }
}
```

âœ… æµ‹è¯•

```bash
curl -X POST http://localhost:8080/users/register \
     -H "Content-Type: application/json" \
     -d '{"username":"ops"}'
```

è¿”å›ï¼š

```json
{"message":"user ops registered"}
```

---

# ä¸ƒã€Repositoryï¼ˆå‡æ•°æ®è®¿é—®ï¼Œæœ€å°å¯è·‘ï¼‰

ğŸ“ `repository/UserRepository.java`

```java
package com.example.opsdemo.repository;

import org.springframework.stereotype.Repository;

@Repository
public class UserRepository {

    public void save(String username) {
        System.out.println("save user: " + username);
    }
}
```

ğŸ“Œ å³ä½¿æ²¡æ•°æ®åº“ï¼Œä¹Ÿèƒ½è·‘ï¼Œ**ç»“æ„å…ˆç«‹ä½**ã€‚

---

# å…«ã€Filterï¼ˆè¯·æ±‚æœ€å¤–å±‚ï¼‰

ğŸ“ `filter/TraceIdFilter.java`

```java
package com.example.opsdemo.filter;

import jakarta.servlet.*;
import jakarta.servlet.http.HttpServletRequest;
import java.io.IOException;
import java.util.UUID;

public class TraceIdFilter implements Filter {

    @Override
    public void doFilter(
            ServletRequest request,
            ServletResponse response,
            FilterChain chain) throws IOException, ServletException {

        String traceId = UUID.randomUUID().toString();
        request.setAttribute("traceId", traceId);

        chain.doFilter(request, response);
    }
}
```

ğŸ“ `config/FilterConfig.java`

```java
package com.example.opsdemo.config;

import com.example.opsdemo.filter.TraceIdFilter;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class FilterConfig {

    @Bean
    public TraceIdFilter traceIdFilter() {
        return new TraceIdFilter();
    }
}
```

âœ… è¿ç»´ç”¨é€”

* ä¸€æ¡è¯·æ±‚ä¸€ä¸ª TraceId
* æ—¥å¿—ä¸²èµ·æ¥

---

# ä¹ã€Interceptorï¼ˆæ¥å£çº§æ‹¦æˆªï¼‰

ğŸ“ `interceptor/AuthInterceptor.java`

```java
package com.example.opsdemo.interceptor;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.web.servlet.HandlerInterceptor;

public class AuthInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(
            HttpServletRequest request,
            HttpServletResponse response,
            Object handler) throws Exception {

        return true; // å…ˆå…¨éƒ¨æ”¾è¡Œ
    }
}
```

ğŸ“ `config/WebConfig.java`

```java
package com.example.opsdemo.config;

import com.example.opsdemo.interceptor.AuthInterceptor;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.*;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new AuthInterceptor())
                .addPathPatterns("/users/**");
    }
}
```

---

# åã€AOPï¼ˆæ¥å£è€—æ—¶ï¼‰

ğŸ“ `aspect/LogAspect.java`

```java
package com.example.opsdemo.aspect;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.springframework.stereotype.Component;

@Aspect
@Component
public class LogAspect {

    @Around("execution(* com.example.opsdemo.controller..*(..))")
    public Object logTime(ProceedingJoinPoint pjp) throws Throwable {
        long start = System.currentTimeMillis();
        Object result = pjp.proceed();
        long cost = System.currentTimeMillis() - start;
        System.out.println("cost=" + cost + "ms");
        return result;
    }
}
```

âœ… è¿ç»´æ„ä¹‰

* ä¸æ”¹ä¸šåŠ¡
* å°±èƒ½çŸ¥é“æ¥å£æ…¢ä¸æ…¢

---

# åä¸€ã€commonï¼ˆç»Ÿä¸€è¿”å›ä½“ï¼Œå¯é€‰ï¼‰

ğŸ“ `common/Result.java`

```java
package com.example.opsdemo.common;

public class Result<T> {
    public boolean success;
    public T data;

    public static <T> Result<T> ok(T data) {
        Result<T> r = new Result<>();
        r.success = true;
        r.data = data;
        return r;
    }
}
```

---

# åäºŒã€ä½ ç°åœ¨å·²ç»å…·å¤‡çš„èƒ½åŠ›

å¦‚æœä½ ç°åœ¨èƒ½åšåˆ°ï¼š

* æ¯ä¸ªåŒ…**çŸ¥é“ä¸ºä»€ä¹ˆå­˜åœ¨**
* çŸ¥é“ **è¯·æ±‚ä¼šç»è¿‡å“ªäº›ç±»**
* çŸ¥é“ **é—®é¢˜å¤§æ¦‚å¡åœ¨å“ªä¸€å±‚**

ä½ å·²ç»å®Œå…¨å…·å¤‡ **è¿ç»´ + æ¥å£å‹ Spring Boot é¡¹ç›®çš„å®æˆ˜èƒ½åŠ›** äº†ã€‚

---

## ä¸‹ä¸€æ­¥ï¼ˆå¼ºçƒˆæ¨èé¡ºåºï¼‰

1ï¸âƒ£ æŠŠè¿™ä¸ª Demo **åŠ ä¸Šæ—¥å¿— + TraceId ä¸²è”**
2ï¸âƒ£ æ¼”ç»ƒä¸€æ¬¡ **æ¥å£æ…¢ â†’ å¦‚ä½•ä¸€æ­¥æ­¥å®šä½**
3ï¸âƒ£ æŠŠè¿™ä¸ªéª¨æ¶ **å‡çº§æˆç”Ÿäº§çº§é…ç½®ï¼ˆçº¿ç¨‹æ±  / æ—¥å¿— / actuatorï¼‰**

ä½ é€‰ä¸€ä¸ªï¼Œæˆ‘ç›´æ¥åœ¨è¿™å¥—ä»£ç ä¸Šç»§ç»­â€œè¿›åŒ–â€ã€‚
