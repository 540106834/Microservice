å¥½ï¼Œæˆ‘ç»™ä½ åšä¸€ä¸ª**å…¨æ™¯å¼ä¸²è”è®²è§£**ï¼ŒæŠŠ DTOã€Controllerã€Serviceã€DAOã€æ•°æ®åº“ç­‰æ¦‚å¿µåƒæµæ°´çº¿ä¸€æ ·ä¸²èµ·æ¥ï¼Œæ—¢é€šä¿—åˆè´´åˆä½ è¿ç»´/æ¥å£å¼€å‘çš„å®é™…åœºæ™¯ã€‚æˆ‘ä»¬ç”¨â€œç°å®ç”Ÿæ´»æ¯”å–» + æ•°æ®æµåŠ¨â€ç»“åˆä»£ç ç¤ºæ„ï¼Œè®©ä½ ä¸€çœ‹å°±æ‡‚æ•´ä¸ªé“¾è·¯ã€‚

---

# ä¸€ã€æ•´ä½“æ¦‚å¿µå¯¹ç…§è¡¨

| å±‚çº§               | ç°å®ç”Ÿæ´»æ¯”å–»     | ä¸»è¦èŒè´£          | æ•°æ®å¯¹è±¡ç±»å‹              |
| ---------------- | ---------- | ------------- | ------------------- |
| Controller       | å®¢äººç‚¹é¤/å‰å°æœåŠ¡å‘˜ | æ¥æ”¶è¯·æ±‚ã€æ ¡éªŒã€è¿”å›ç»“æœ  | DTOï¼ˆè¯·æ±‚/å“åº”ï¼‰          |
| Service          | å¨å¸ˆ         | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†ã€è§„åˆ™åˆ¤æ–­ | DTO â†’ Domain/Entity |
| DAO / Repository | å¨æˆ¿åå¨       | æ•°æ®åº“å­˜å–ã€CRUD    | Entity              |
| æ•°æ®åº“              | å†°ç®± / é£Ÿæ    | æ°¸ä¹…å­˜å‚¨          | è¡¨/è®°å½•                |

ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼š

> **æ¯å±‚åªåšè‡ªå·±èŒè´£ï¼Œä¸è¶Šç•Œã€‚**
> Controller ä¸å†™ä¸šåŠ¡ï¼ŒService ä¸ç®¡ SQLï¼ŒDAO ä¸åšä¸šåŠ¡åˆ¤æ–­ã€‚

---

# äºŒã€æ•°æ®æµé€šå…¨è¿‡ç¨‹

å‡è®¾åœºæ™¯ï¼š**ç”¨æˆ·æ³¨å†Œ**

## 1ï¸âƒ£ Controllerï¼šæ¥æ”¶è¯·æ±‚

* ç”¨æˆ·åœ¨å‰ç«¯å¡«äº†ç”¨æˆ·åå’Œé‚®ç®±ï¼Œå‘è¯·æ±‚åˆ°æ¥å£
* Controller æ”¶åˆ°è¯·æ±‚ï¼ŒæŠŠ JSON â†’ `UserDTO`

```java
@RestController
@RequestMapping("/user")
public class UserController {

    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @PostMapping("/register")
    public Result<UserDTO> registerUser(@RequestBody UserDTO userDTO) {
        UserDTO result = userService.register(userDTO);
        return Result.success(result);
    }
}
```

* **èŒè´£**ï¼šåªåšâ€œæ”¶ã€è½¬ã€å‘â€ï¼Œä¸å†™ä¸šåŠ¡é€»è¾‘
* **ä¼ é€’å¯¹è±¡**ï¼šDTOï¼ˆData Transfer Objectï¼‰

---

## 2ï¸âƒ£ DTOï¼šæ•°æ®ä¼ è¾“å¯¹è±¡

```java
public class UserDTO {
    private String username;
    private String email;
    // getter/setter
}
```

* **ä½œç”¨**ï¼š

  * Controller â†” Service æ•°æ®è½½ä½“
  * ä¸å«ä¸šåŠ¡é€»è¾‘ï¼Œåªå­˜æ•°æ®
* **ç‰¹ç‚¹**ï¼šè½»é‡ã€çº¯ç²¹ã€æ–¹ä¾¿åºåˆ—åŒ– JSON

---

## 3ï¸âƒ£ Serviceï¼šä¸šåŠ¡é€»è¾‘å¤„ç†

```java
@Service
public class UserService {

    private final UserRepository userRepository; // DAO å±‚

    public UserDTO register(UserDTO userDTO) {
        // ä¸šåŠ¡æ ¡éªŒ
        if (userDTO.getUsername() == null || userDTO.getUsername().isEmpty()) {
            throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        }

        // DTO â†’ Entity
        UserEntity entity = new UserEntity();
        entity.setUsername(userDTO.getUsername());
        entity.setEmail(userDTO.getEmail());

        // è°ƒç”¨ DAO ä¿å­˜
        userRepository.save(entity);

        // è¿”å›ç»™ Controller
        return userDTO;
    }
}
```

* **èŒè´£**ï¼š

  * æ ¡éªŒä¸šåŠ¡è§„åˆ™
  * æ•°æ®è½¬æ¢ï¼ˆDTO â†’ Entityï¼‰
  * è°ƒç”¨ DAO
* **å¯¹è±¡ç±»å‹**ï¼š

  * è¾“å…¥ï¼šDTO
  * è¾“å‡ºï¼šDTO æˆ–ä¸šåŠ¡ç»“æœ

---

## 4ï¸âƒ£ DAO / Repositoryï¼šæ•°æ®åº“è®¿é—®å±‚

```java
@Repository
public interface UserRepository extends JpaRepository<UserEntity, Long> {}
```

* **èŒè´£**ï¼š

  * å¯¹æ•°æ®åº“åšå¢åˆ æ”¹æŸ¥
  * å°è£… SQL / ORM æ“ä½œ
* **å¯¹è±¡ç±»å‹**ï¼š

  * Entityï¼ˆæ•°æ®åº“è¡¨æ˜ å°„ç±»ï¼‰

```java
@Entity
public class UserEntity {
    @Id
    @GeneratedValue
    private Long id;
    private String username;
    private String email;
    // getter/setter
}
```

* Entity = æ•°æ®åº“è¡¨å¯¹åº”å¯¹è±¡
* Service ä¸ç›´æ¥æ“ä½œ SQLï¼Œåªäº¤ç»™ DAO

---

## 5ï¸âƒ£ æ•°æ®åº“ï¼šå­˜å‚¨å±‚

* **èŒè´£**ï¼š

  * æ°¸ä¹…å­˜å‚¨æ•°æ®
  * DAO æ“ä½œ SQL
* **æ˜ å°„**ï¼š

  * Entity å¯¹åº”æ•°æ®åº“è¡¨
  * `UserEntity` â†’ `user` è¡¨

```text
user è¡¨ç»“æ„
+----+----------+-------------------+
| id | username | email             |
+----+----------+-------------------+
| 1  | zhangsan | zhangsan@test.com |
+----+----------+-------------------+
```

---

## ä¸‰ã€å®Œæ•´æ•°æ®æµå›¾

```
ç”¨æˆ·å‘é€æ³¨å†Œè¯·æ±‚ (JSON)
          â†“
Controller (UserController)
  æ”¶åˆ°è¯·æ±‚ï¼Œè½¬æ¢æˆ DTO (UserDTO)
          â†“
Service (UserService)
  ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ ¡éªŒè§„åˆ™
  DTO â†’ Entity
          â†“
DAO / Repository (UserRepository)
  ä¿å­˜ Entity åˆ°æ•°æ®åº“
          â†“
æ•°æ®åº“è¡¨ (user)
  æ°¸ä¹…å­˜å‚¨
          â†‘
DAO è¿”å› Entity â†’ Service
Service å¯ä»¥è¿”å› DTO â†’ Controller
Controller åŒ…è£… Result<T> â†’ è¿”å›ç»™ç”¨æˆ·
```

---

## å››ã€ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ†å±‚ï¼Ÿ

1. **èŒè´£å•ä¸€**

   * Controller ä¸å†™ä¸šåŠ¡
   * Service ä¸å…³å¿ƒæ•°æ®åº“
   * DAO ä¸å†™ä¸šåŠ¡é€»è¾‘

2. **è§£è€¦ã€å¯æµ‹è¯•**

   * Service å¯ä»¥å•å…ƒæµ‹è¯•ä¸ç”¨æ•°æ®åº“
   * DAO å¯ä»¥ç‹¬ç«‹æµ‹è¯•æ•°æ®åº“æ“ä½œ

3. **å¯æ‰©å±•**

   * å¢åŠ å­—æ®µåªæ”¹ Entity + Mapper
   * æ”¹ä¸šåŠ¡é€»è¾‘åªæ”¹ Service
   * Controller è¿”å›æ ¼å¼ç»Ÿä¸€ Result<T>

4. **å®‰å…¨ & å¼‚å¸¸å¯æ§**

   * Service æŠ›ä¸šåŠ¡å¼‚å¸¸
   * Controller æˆ–å…¨å±€å¼‚å¸¸å¤„ç†ç»Ÿä¸€å°è£…

---

## äº”ã€å®Œæ•´é“¾æ¡ç¤ºæ„ä»£ç ï¼ˆæ•´åˆï¼‰

```java
// DTO
public class UserDTO { String username; String email; }

// Entity
@Entity
public class UserEntity { @Id Long id; String username; String email; }

// DAO
@Repository
interface UserRepository extends JpaRepository<UserEntity, Long> {}

// Service
@Service
public class UserService {
    private final UserRepository dao;
    public UserService(UserRepository dao){ this.dao=dao; }
    public UserDTO register(UserDTO dto){
        if(dto.getUsername()==null) throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        UserEntity entity=new UserEntity();
        entity.setUsername(dto.getUsername());
        entity.setEmail(dto.getEmail());
        dao.save(entity);
        return dto;
    }
}

// Controller
@RestController
@RequestMapping("/user")
public class UserController{
    private final UserService service;
    public UserController(UserService s){ this.service=s; }
    @PostMapping("/register")
    public Result<UserDTO> reg(@RequestBody UserDTO dto){
        return Result.success(service.register(dto));
    }
}
```

---

âœ… **ç°åœ¨ä½ è„‘æµ·é‡Œæœ‰ä¸€ä¸ªå®Œæ•´çš„é“¾è·¯äº†**ï¼š

**Controller â†’ DTO â†’ Service â†’ Entity â†’ DAO â†’ æ•°æ®åº“ â†’ DAO â†’ Service â†’ DTO â†’ Controller â†’ Result<T> â†’ ç”¨æˆ·**

è¿™å°±æ˜¯**ç°ä»£ Spring Boot é¡¹ç›®é‡Œæ¥å£è¯·æ±‚å®Œæ•´æµç¨‹**ï¼Œä¹Ÿæ˜¯è¿ç»´/æ¥å£å¼€å‘çš„æ ‡å‡†éª¨æ¶ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ **æŠŠä¹‹å‰çš„ç›´è¿ç¬”è®°æœ¬ Spring Boot ç”¨æˆ·æ³¨å†Œæ¡ˆä¾‹å‡çº§**ï¼š

* åŠ ä¸Š **DAO / Entity**
* åŠ ä¸Š **Result<T> ç»Ÿä¸€è¿”å›**
* åŠ ä¸Š **å…¨å±€å¼‚å¸¸å¤„ç†**

è®©å®ƒç›´æ¥å˜æˆ **çœŸå®çº¿ä¸Šå¯ç”¨éª¨æ¶**ï¼Œä½ ä¸€è·‘å°±èƒ½æµ‹è¯•æ•°æ®åº“æ“ä½œã€‚

ä½ å¸Œæœ›æˆ‘ç›´æ¥å¸®ä½ å†™å—ï¼Ÿ
