å¥½ï¼Œè¿™ä¸€ç»„æˆ‘ä»¬æ¥**ä¸€æ¬¡æ€§æŠŠâ€œå°è£…ã€ç»§æ‰¿ã€å¤šæ€â€æ‰“é€š**ã€‚
è¿˜æ˜¯ç”¨ä½ ç†Ÿæ‚‰çš„ **è¿ç»´ â†’ Java å¯¹è±¡æ¨¡å‹**ï¼Œä¸æŠ½è±¡ï¼Œä¸é£˜ 

ä½ ä¼šçœ‹åˆ°ï¼š
**åŒä¸€å¥—ä»£ç ï¼ŒSpring Bootã€Dockerã€K8s çš„å½±å­åœ¨é‡Œé¢æ™ƒåŠ¨**ã€‚

---

# ä¸€ã€å°è£…ï¼šæŠŠâ€œå±é™©æ“ä½œâ€å…³è¿›ç›’å­é‡Œ

## æ¡ˆä¾‹ 1ï¼šJvmProcessï¼ˆå°è£…çš„æ„ä¹‰ï¼‰

### âŒ æ²¡å°è£…çš„ä¸–ç•Œ

```java
process.memory = -1;
process.running = true;
```

è¿ç»´çœ‹åˆ°ä¼šç›´æ¥æ€æ¡Œ ğŸª‘

---

### âœ… å°è£…å

```java
public class JvmProcess {
    private int memory;
    private boolean running;

    public JvmProcess(int memory) {
        setMemory(memory);
    }

    public void setMemory(int memory) {
        if (memory <= 0) {
            throw new IllegalArgumentException("å†…å­˜å¿…é¡»å¤§äº 0");
        }
        this.memory = memory;
    }

    public int getMemory() {
        return memory;
    }

    public void start() {
        running = true;
        System.out.println("JVM å¯åŠ¨ï¼Œå ç”¨å†…å­˜ " + memory + "MB");
    }
}
```

**ä½ è¯¥é¢†æ‚Ÿçš„ç‚¹**

* `private` æ˜¯æŠ¤åŸæ²³
* setter æ˜¯å®¡è®¡è§„åˆ™
* æ„é€ å™¨ â‰ˆ å¯åŠ¨è„šæœ¬

---

# äºŒã€ç»§æ‰¿ï¼šåŒä¸€ç±»äº‹ç‰©çš„â€œå…±æ€§â€

## æ¡ˆä¾‹ 2ï¼šService çš„ç»§æ‰¿ä½“ç³»

### çˆ¶ç±»ï¼šBaseService

```java
public abstract class BaseService {
    protected String name;
    protected int port;

    public BaseService(String name, int port) {
        this.name = name;
        this.port = port;
    }

    public abstract void start();

    public void printInfo() {
        System.out.println("æœåŠ¡ï¼š" + name + "ï¼Œç«¯å£ï¼š" + port);
    }
}
```

---

### å­ç±» 1ï¼šWebService

```java
public class WebService extends BaseService {

    public WebService(String name, int port) {
        super(name, port);
    }

    @Override
    public void start() {
        System.out.println("å¯åŠ¨ Web æœåŠ¡ï¼š" + name);
    }
}
```

---

### å­ç±» 2ï¼šJobService

```java
public class JobService extends BaseService {

    public JobService(String name, int port) {
        super(name, port);
    }

    @Override
    public void start() {
        System.out.println("å¯åŠ¨ å®šæ—¶ä»»åŠ¡ æœåŠ¡ï¼š" + name);
    }
}
```

**ç†è§£é‡ç‚¹**

* `extends` æ˜¯â€œis-aâ€
* WebService **æ˜¯** Service
* çˆ¶ç±»æ”¾å…±æ€§ï¼Œå­ç±»æ”¾å·®å¼‚

---

# ä¸‰ã€å¤šæ€ï¼šçœŸæ­£çš„â€œè‡ªåŠ¨åŒ–â€

## æ¡ˆä¾‹ 3ï¼šå¤šæ€å¯åŠ¨æœåŠ¡

```java
public class Host {

    public void startService(BaseService service) {
        service.printInfo();
        service.start();
    }
}
```

### ä¸»ç¨‹åº

```java
public class Main {
    public static void main(String[] args) {
        Host host = new Host();

        BaseService web = new WebService("gateway", 8080);
        BaseService job = new JobService("sync-job", 9000);

        host.startService(web);
        host.startService(job);
    }
}
```

**å‘ç”Ÿäº†ä»€ä¹ˆ**

* Host ä¸å…³å¿ƒä½ æ˜¯ Web è¿˜æ˜¯ Job
* åªå…³å¿ƒä½ æ˜¯ **BaseService**
* è¿è¡Œæ—¶è‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„ `start()`

è¿™å°±æ˜¯ Spring çš„çµé­‚ ğŸ‘»

---

# å››ã€å°è£… + ç»§æ‰¿ + å¤šæ€ åˆä½“æŠ€

## æ¡ˆä¾‹ 4ï¼šæœåŠ¡ + JVM è¿›ç¨‹

### æŠ½è±¡çˆ¶ç±»

```java
public abstract class AbstractService {
    protected String name;
    private JvmProcess process;

    public AbstractService(String name, int memory) {
        this.name = name;
        this.process = new JvmProcess(memory);
    }

    public void start() {
        beforeStart();
        process.start();
        afterStart();
    }

    protected abstract void beforeStart();

    protected void afterStart() {
        System.out.println(name + " å¯åŠ¨å®Œæˆ");
    }
}
```

---

### å­ç±»

```java
public class NacosService extends AbstractService {

    public NacosService(int memory) {
        super("nacos", memory);
    }

    @Override
    protected void beforeStart() {
        System.out.println("åŠ è½½ nacos é…ç½®");
    }
}
```

```java
public class OrderService extends AbstractService {

    public OrderService(int memory) {
        super("order-service", memory);
    }

    @Override
    protected void beforeStart() {
        System.out.println("è¿æ¥æ•°æ®åº“");
    }
}
```

---

### å¯åŠ¨å™¨

```java
public class Main {
    public static void main(String[] args) {
        AbstractService s1 = new NacosService(512);
        AbstractService s2 = new OrderService(1024);

        s1.start();
        s2.start();
    }
}
```

**ä½ å·²ç»å†™å‡ºäº†**

* æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆSpring å¸¸ç”¨ï¼‰
* ç”Ÿäº§çº§æœåŠ¡å¯åŠ¨æ¨¡å‹

---

# äº”ã€è¿ç»´è§†è§’æ€»ç»“

| æ¦‚å¿µ | è¿ç»´ç†è§£       |
| -- | ---------- |
| å°è£… | ç¦æ­¢æ‰‹å·¥æ”¹çº¿ä¸Šå‚æ•°  |
| ç»§æ‰¿ | åŒç±»æœåŠ¡çš„æ ‡å‡†åŒ–   |
| å¤šæ€ | åŒä¸€è„šæœ¬ç®¡ç†ä¸åŒæœåŠ¡ |

---

# å…­ã€ç»™ä½ çš„æŒ‘æˆ˜é¢˜ï¼ˆå¼ºçƒˆæ¨èï¼‰

ğŸ”¥ ç»ƒä¹  1
åŠ ä¸€ä¸ª `stop()` æ–¹æ³•

* çˆ¶ç±»ç»Ÿä¸€æµç¨‹
* å­ç±»å¯å®šåˆ¶

ğŸ”¥ ç»ƒä¹  2
å¼•å…¥ `HealthCheck`

* WebService è¿”å› UP
* JobService è¿”å› DEGRADED

ğŸ”¥ ç»ƒä¹  3
æ¨¡æ‹Ÿ OOM

* JVM å†…å­˜ä¸è¶³æŠ›å¼‚å¸¸
* Host æ•è·å¹¶æ‰“ ERROR æ—¥å¿—

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ï¼š

* æŠŠè¿™å¥—æ¨¡å‹**æ˜ å°„åˆ° Spring Boot Bean ç”Ÿå‘½å‘¨æœŸ**
* æˆ–ç›´æ¥å¸¦ä½ **æ‰‹å†™ä¸€ä¸ªè¿·ä½  IOC å®¹å™¨**
* æˆ–ç»“åˆ **Nacos + é…ç½®çƒ­æ›´æ–°**

ä½ ç‚¹å“ªä¸ªï¼Œæˆ‘å°±æŠŠå“ªæ‰‡é—¨æ¨å¼€ ğŸšª
