å¥½çš„ï¼Œæˆ‘ä»¬æ¥ç³»ç»Ÿæ¢³ç† **ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection, DIï¼‰** å’Œ **åˆ†å±‚è®¾è®¡ï¼ˆLayered Architectureï¼‰**ï¼Œå¹¶ç»“åˆ Spring Boot çš„ Controller/Service/DTO æ¨¡å¼ï¼Œè®©ä½ æ¸…æ™°ç†è§£å¯¹è±¡å…³ç³»å’Œè°ƒç”¨æµç¨‹ã€‚

---

## 1ï¸ ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰

###  æ¦‚å¿µ

ä¾èµ–æ³¨å…¥æ˜¯**æ§åˆ¶åè½¬ï¼ˆIoCï¼‰çš„ä¸€ç§æ–¹å¼**ï¼š

* ä¸ç”±å¯¹è±¡è‡ªå·±å»åˆ›å»ºä¾èµ–ï¼Œè€Œæ˜¯**ç”±å®¹å™¨ï¼ˆSpringï¼‰è´Ÿè´£æä¾›**ã€‚
* è¿™æ ·å¯¹è±¡åªå…³å¿ƒâ€œç”¨ä»€ä¹ˆâ€ï¼Œè€Œä¸ç”¨å…³å¿ƒâ€œæ€ä¹ˆåˆ›å»ºâ€ã€‚

ä¸€å¥è¯å…ˆç»™ç»“è®º
ä¾èµ–æ³¨å…¥çš„æœ¬è´¨ï¼š
æŠŠâ€œæˆ‘ç”¨è°â€è¿™ä¸ªå†³å®šæƒï¼Œä»ä»£ç é‡Œï¼ŒæŒªåˆ°å¤–é¢ã€‚

ä»£ç åªè´Ÿè´£â€œå¹²æ´»â€ï¼Œ
ä¸è´Ÿè´£å†³å®šç”¨å“ªä¸ªå·¥å…·ã€å“ªä¸ªå®ç°ã€å“ªä¸ªç‰ˆæœ¬ã€‚

###  ä¾‹å­å¯¹æ¯”

#### 1. æ‰‹åŠ¨åˆ›å»ºä¾èµ–ï¼ˆé DIï¼‰

```java
public class UserController {
    private final UserService userService = new UserService(); // è‡ªå·±åˆ›å»º
}
```

ç¼ºç‚¹ï¼š

* å¼ºè€¦åˆï¼Œæ— æ³•æ›¿æ¢å®ç°
* æµ‹è¯•å›°éš¾

#### 2. ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰

```java
@RestController
public class UserController {
    private final UserService userService;

    // æ„é€ å™¨æ³¨å…¥ï¼ˆæ¨èï¼‰
    public UserController(UserService userService) {
        this.userService = userService;
    }
}
```

* Spring è‡ªåŠ¨åˆ›å»º `UserService` å®ä¾‹ï¼Œå¹¶æ³¨å…¥ Controller
* Controller åªä¾èµ–æ¥å£æˆ–ç±»ï¼Œä¸å…³å¿ƒå®ä¾‹åŒ–è¿‡ç¨‹

###  DI ç±»å‹

1. **æ„é€ å™¨æ³¨å…¥**ï¼ˆæ¨èï¼‰
2. **Setter æ³¨å…¥**
3. **å­—æ®µæ³¨å…¥**ï¼ˆ`@Autowired`ï¼Œå¯è¡Œä½†ä¸æ¨èï¼‰

---

## 2ï¸ åˆ†å±‚è®¾è®¡ï¼ˆLayered Architectureï¼‰

###  æ ¸å¿ƒæ€æƒ³

å°†ç³»ç»Ÿæ‹†åˆ†æˆç‹¬ç«‹å±‚æ¬¡ï¼Œæ¯å±‚è´Ÿè´£ä¸åŒèŒè´£ï¼Œå‡å°‘è€¦åˆï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚

###  å¸¸è§å±‚æ¬¡

| å±‚                         | ä½œç”¨        | ç¤ºä¾‹å¯¹è±¡                              |
| ------------------------- | --------- | --------------------------------- |
| **Controllerï¼ˆæ¥å£å±‚ï¼‰**       | æ¥æ”¶è¯·æ±‚ã€è¿”å›å“åº” | `UserController`                  |
| **Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰**        | æ‰§è¡Œä¸šåŠ¡è§„åˆ™    | `UserService` / `UserServiceImpl` |
| **Repository/DAOï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰** | æ•°æ®åº“æ“ä½œ     | `UserRepository`                  |
| **DTO/VOï¼ˆæ•°æ®ä¼ è¾“å±‚ï¼‰**         | è¯·æ±‚/å“åº”æ•°æ®è½½ä½“ | `UserDTO` / `UserVO`              |
| **å®ä½“å±‚ï¼ˆEntityï¼‰**           | æ•°æ®åº“æ˜ å°„     | `User` å®ä½“ç±»                        |

---

###  åˆ†å±‚è®¾è®¡çš„å¥½å¤„

1. **è§£è€¦**ï¼šController ä¸å…³å¿ƒ Service å†…éƒ¨é€»è¾‘ï¼ŒService ä¸å…³å¿ƒ Controller
2. **å¯æ›¿æ¢**ï¼šService å¯æ¢å®ç°ï¼ˆæ¥å£ + å®ç°ç±»ï¼‰
3. **å¯æµ‹è¯•**ï¼šå„å±‚å¯å•ç‹¬æµ‹è¯•
4. **å¯å¤ç”¨**ï¼šService å¯è¢«å¤šä¸ª Controller è°ƒç”¨

---

## 3ï¸ ç»¼åˆæ¡ˆä¾‹

```
å‰ç«¯è¯·æ±‚ ---> Controller ---> Service ---> Repository ---> æ•°æ®åº“
                 |                         |
                 |--> DTO/VO               |
```

### ç¤ºä¾‹ä»£ç 

```java
// DTO
public class UserDTO {
    private String username;
    private String email;
    // getter/setter
}

// å®ä½“
@Entity
public class User {
    private String username;
    private String email;
    // getter/setter
}

// Repository
@Repository
public interface UserRepository extends JpaRepository<User, Long> {}

// Service æ¥å£
public interface UserService {
    String register(UserDTO userDTO);
}

// Service å®ç°ç±»
@Service
public class UserServiceImpl implements UserService {
    private final UserRepository userRepository;

    // æ„é€ å™¨æ³¨å…¥
    public UserServiceImpl(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Override
    public String register(UserDTO userDTO) {
        User user = new User();
        user.setUsername(userDTO.getUsername());
        user.setEmail(userDTO.getEmail());
        userRepository.save(user);
        return "æ³¨å†ŒæˆåŠŸï¼š" + user.getUsername();
    }
}

// Controller
@RestController
@RequestMapping("/user")
public class UserController {
    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }

    @PostMapping("/register")
    public String register(@RequestBody UserDTO userDTO) {
        return userService.register(userDTO);
    }
}
```

### ğŸ”¹ æµç¨‹è§£æ

1. å‰ç«¯å‘è¯·æ±‚ â†’ Controller æ¥æ”¶ DTO
2. Controller è°ƒç”¨ Service æ¥å£ â†’ å…·ä½“å®ç°ç±»å¤„ç†ä¸šåŠ¡
3. Service è°ƒç”¨ Repository ä¿å­˜æ•°æ®
4. è¿”å›ç»“æœ â†’ Controller â†’ å‰ç«¯

> âœ… å…³é”®ç‚¹ï¼š
>
> * **ä¾èµ–æ³¨å…¥**ï¼šController å’Œ Service éƒ½ä¸è‡ªå·± new å¯¹è±¡
> * **åˆ†å±‚è®¾è®¡**ï¼šå„å±‚èŒè´£æ¸…æ™°ï¼Œäº’ä¸è€¦åˆ
> * **DTO/Entity åˆ†ç¦»**ï¼šä¿è¯æ¥å£å’Œæ•°æ®åº“ç»“æ„è§£è€¦

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼  **â€œä¾èµ–æ³¨å…¥ + åˆ†å±‚è®¾è®¡ + å¯¹è±¡æµåŠ¨â€å¯è§†åŒ–å›¾**ï¼Œæ ‡å‡º Controllerã€Serviceã€Repositoryã€DTOã€Entity çš„å¯¹è±¡å…³ç³»å’Œæ•°æ®æµåŠ¨ï¼Œä¸€çœ¼çœ‹æ‡‚æ•´ä¸ªæ¥å£æ¶æ„ã€‚

ä½ å¸Œæœ›æˆ‘ç”»å—ï¼Ÿ
