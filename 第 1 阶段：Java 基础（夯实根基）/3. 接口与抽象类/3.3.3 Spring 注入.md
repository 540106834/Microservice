**Spring 注入**，像把零件送进机器，而不是你自己满仓库找螺丝 。
你只负责“用”，Spring 负责“给”。

---

## 一、什么是 Spring 注入？

一句话版：

> **Spring 把对象创建好，再塞到你需要的地方**

也叫 **依赖注入（DI, Dependency Injection）**。

没有注入的世界：

```java
Service s = new Service();  // 自己造
```

有注入的世界：

```java
@Autowired
private Service service;   // Spring 给
```

你不关心：

* 谁 new 的
* 什么时候 new
* new 几次

---

## 二、注入解决了什么问题？

### 没注入前的痛点 

```java
class OrderController {
    OrderService service = new OrderService();
}
```

问题：

* 强耐耦合
* 不好测试
* 换实现要全改

### 注入之后 

```java
@RestController
class OrderController {

    private final OrderService service;

    public OrderController(OrderService service) {
        this.service = service;
    }
}
```

👉 **控制反转（IOC）**：
你不再控制对象创建权

---

## 三、Spring 注入的三种方式（重点）

### 1️⃣ 构造器注入（⭐最推荐）

```java
@Service
public class OrderService {
}

@RestController
public class OrderController {

    private final OrderService orderService;

    public OrderController(OrderService orderService) {
        this.orderService = orderService;
    }
}
```

优点：

* 不可为 null
* 便于测试
* 官方推荐

---

### 2️⃣ 属性注入（最常见，但不推荐）

```java
@Autowired
private OrderService orderService;
```

问题：

* 隐藏依赖
* 单测麻烦

👉 **能写构造器就别用它**

---

### 3️⃣ Setter 注入（可选）

```java
@Autowired
public void setOrderService(OrderService orderService) {
    this.orderService = orderService;
}
```

适合：

* 可选依赖
* 需要后期替换

---

## 四、Spring 是怎么“找到”对象的？

### 1️⃣ 标记为 Bean

```java
@Component
@Service
@Repository
@Controller
@RestController
```

这些本质都是 `@Component` 的“马甲”。

---

### 2️⃣ 扫描 + 注册

```java
@SpringBootApplication
```

≈

```java
@ComponentScan
@EnableAutoConfiguration
```

Spring 启动时：

* 扫包
* 创建 Bean
* 放进 IOC 容器

---

## 五、多个实现怎么注入？

### 接口 + 多实现

```java
public interface PayService {
    void pay();
}
```

```java
@Service("aliPay")
class AliPayService implements PayService {}

@Service("wxPay")
class WxPayService implements PayService {}
```

### 指定注入哪个

```java
@Autowired
@Qualifier("aliPay")
private PayService payService;
```

或：

```java
@Primary
@Service
class AliPayService implements PayService {}
```

---

## 六、你运维 / 架构视角一定要懂的点 🧠

### Bean 是单例吗？

默认是：

```java
@Scope("singleton")
```

也可以：

```java
@Scope("prototype")
```

---

### 配置注入（很常见）

```java
@Value("${server.port}")
private int port;
```

或更优雅：

```java
@ConfigurationProperties(prefix = "server")
public class ServerConfig {
    private int port;
}
```

---

## 七、常见坑 ⚠️

❌ 忘了加 `@Component`
→ 注入失败

❌ 循环依赖

```text
A -> B -> A
```

❌ 多实现没指定

```text
NoUniqueBeanDefinitionException
```

---

## 八、一句话记忆

> **Spring 注入 = 你声明“我要什么”，Spring 决定“给哪个”** 🎁

如果你愿意，我可以下一步帮你：

* 画一张 **IOC 容器生命周期流程图**
* 拆 **Spring 启动时 Bean 是怎么一步步注入的**
* 从 **Nacos / 配置中心角度** 看注入
* 专门讲 **为什么强烈推荐构造器注入**

点一个，我继续。
