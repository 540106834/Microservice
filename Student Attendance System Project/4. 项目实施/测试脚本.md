要实现**随机值**和**自增变量**，你需要编写一个简单的 Shell 脚本循环。在 Bash 中，我们可以使用 `$RANDOM` 变量生成随机数，并使用 `((i++))` 来处理自增。

```bash
curl -X POST http://172.17.17.81:8080/api/raw/save \
  -H "Content-Type: application/json" \
  -d "{
        \"deviceSn\": \"860123456789013\",
        \"cardNo\": \"00004568\",
        \"eventTime\": \"$(date +'%Y-%m-%d %H:%M:%S')\",
        \"eventType\": 0,
        \"sn\": \"0001\"
      }"

```

你可以直接在终端创建一个 `test.sh` 文件，或者直接粘贴以下代码运行：

### 1. 自动化测试脚本 (`test_attendance.sh`)

```bash
#!/bin/bash

# 初始化 sn 的起始值
SN_COUNTER=1

# 循环发送 10 次（你可以根据需要修改次数）
for i in {1..10}
do
    # 生成随机的 deviceSn (示例：860 + 12位随机数)
    RAND_DEVICE="860$(printf "%012d" $((RANDOM%1000000000000)))"
    
    # 生成随机的 cardNo (示例：8位随机数)
    # RAND_CARD="$(printf "%08d" $((RANDOM%100000000)))"
    RAND_CARD="$(head /dev/urandom | tr -dc '0-9' | head -c 8; echo)"
    # 获取当前时间
    CURRENT_TIME=$(date +'%Y-%m-%d %H:%M:%S')
    
    # 格式化当前的 SN (补齐4位，如 0001)
    FORMATTED_SN=$(printf "%04d" $SN_COUNTER)

    echo "正在发送第 $i 次请求: SN=$FORMATTED_SN, Device=$RAND_DEVICE"

    # 执行 curl
    curl -X POST http://172.17.17.81:8080/api/raw/save \
      -H "Content-Type: application/json" \
      -d "{
            \"deviceSn\": \"$RAND_DEVICE\",
            \"cardNo\": \"$RAND_CARD\",
            \"eventTime\": \"$CURRENT_TIME\",
            \"eventType\": 0,
            \"sn\": \"$FORMATTED_SN\"
          }"

    # 换行并增加计数器
    echo -e "\n--------------------------"
    ((SN_COUNTER++))
    
    # 可选：稍微停顿一下，避免过快
    sleep 0.1
done

```

---

### 2. 关键语法解析

* **`$(printf "%04d" $SN_COUNTER)`**: 这是一个“补零”技巧。它能把数字 `1` 变成 `0001`，确保符合你 JSON 里的格式要求。
* **`$RANDOM`**: Bash 内置变量，返回 0 到 32767 之间的整数。通过 `printf` 格式化，我们可以生成固定长度的随机 ID。
* **变量注入**: 注意 `-d` 后面的 JSON 字符串使用了**双引号**包裹，这样里面的 `$RAND_DEVICE` 等变量才能被 Shell 正确替换。

---

### 3. 如何运行

1. **创建文件**: `vi test_attendance.sh`
2. **粘贴代码**: 按 `i` 进入编辑模式，粘贴后按 `Esc` 输入 `:wq` 保存。
3. **赋予权限**: `chmod +x test_attendance.sh`
4. **执行**: `./test_attendance.sh`

---

### 💡 进阶建议

如果你的 Spring Boot 后端现在还在报 **500 错误**，请检查你的 `RawService` 里的 SQL 语句。因为你现在 JSON 里的 key 改成了 `deviceSn`、`cardNo`、`eventTime`，确保你的数据库表 `attendance_raw` 里已经增加了对应的列：

```sql
ALTER TABLE attendance_raw ADD COLUMN card_no VARCHAR(20);
ALTER TABLE attendance_raw ADD COLUMN event_time DATETIME;

```

**运行脚本后，数据库里成功刷出这 10 条随机数据了吗？**

好的，我来给你 **非常详细地说明**这个 `/dev/urandom` 方法，逐步拆解每一部分，保证你完全理解它是怎么生成 12 位随机数字的。

---

## 命令整体

```bash
head /dev/urandom | tr -dc '0-9' | head -c 8; echo
```

---

### 1️⃣ `head /dev/urandom`

* `/dev/urandom` 是 Linux/Unix 系统提供的 **伪随机设备**，它会持续输出随机的字节流。
* 每次读取时，返回的是 **原始二进制数据**（包含各种 ASCII 字符和不可打印字符）。
* `head` 默认读取前 10 行，但在这里它会把一些随机字节流传给下一步命令。
* 作用：**提供大量随机源**。

💡 注意：这里不是生成数字，而是生成 **随机字符流**。

---

### 2️⃣ `tr -dc '0-9'`

* `tr` 是字符转换/删除命令。
* 选项解释：

  * `-d` → 删除指定字符
  * `-c` → 取反（意思是“删除除了…之外的字符”）
* `'0-9'` → 指定只保留数字字符
* 所以这一段的作用是：**从随机字符流中过滤出数字**。
* 结果：得到一个纯数字的随机字符串，长度不固定，可能很长。

---

### 3️⃣ `head -c 12`

* `head` 的 `-c N` 选项表示 **只取前 N 个字节/字符**。
* `12` → 只取前 12 个字符
* 所以这一段的作用是：**截取前 12 个数字字符**，保证长度正好是 12 位。

---

### 4️⃣ `echo`

* 为了保证输出带换行，避免生成的数字紧跟在命令行提示符后面。
* 这一步只是美观，可选。

---

### ✅ 特性总结

* **每次输出都是 12 位数字**
* **完全随机**，使用系统随机源 `/dev/urandom`
* **不受 Bash `RANDOM` 32767 限制**
* **不依赖任何额外工具**（除了标准 Unix 命令）
* 可以轻松改成任意位数，只需把 `head -c 12` 改为 `head -c N`

---

### 🔧 拓展：函数形式

你可以写成一个 Bash 函数，以后直接调用生成任意长度随机数字：

```bash
randnum() {
  local length=${1:-12}  # 默认12位
  head /dev/urandom | tr -dc '0-9' | head -c "$length"; echo
}

# 使用
randnum        # 默认生成12位
randnum 16     # 生成16位
```

* `randnum` → 函数名
* `$1` → 可传入位数
* `${1:-12}` → 如果没有传参，默认 12 位

---

如果你愿意，我可以帮你写一个 **更高级版本**，保证 **第一位不为 0**（这样生成的数字真正是 12 位，不会出现前导 0 导致看起来少位的情况），这在生成 ID、卡号时非常实用。

你希望我帮你写这个版本吗？
