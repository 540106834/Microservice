å¾ˆå¥½ã€‚çŽ°åœ¨ä¸æ˜¯â€œæ•™å­¦æ¨¡å¼â€äº†ã€‚

æˆ‘ä»¬è¦è¿›å…¥ä¸€ç§æ›´æŽ¥è¿‘çœŸå®žå…¬å¸çš„çŠ¶æ€ï¼š

> **ä»Šå¤©ç«‹é¡¹ï¼Œä¸‹å‘¨è¦å»ºåº“ï¼Œä¸€ä¸ªæœˆåŽå¯èƒ½ä¸Šçº¿ã€‚**

å°‘ä¸€ç‚¹ç†å¿µï¼Œå¤šä¸€ç‚¹å¯è½åœ°çš„é’¢ç­‹æ°´æ³¥ã€‚

æŽ¥ä¸‹æ¥æˆ‘ä¼šç›´æŽ¥ç»™ä½ ä¸€å¥—ï¼š

> **å¯ç”¨äºŽçœŸå®žé¡¹ç›®ä¸€æœŸä¸Šçº¿çš„æ•°æ®åº“éª¨æž¶ã€‚**
> ä¸æ˜¯çŽ©å…·æ¨¡åž‹ï¼Œæ˜¯åç”Ÿäº§æ€è·¯ã€‚

ä½ å¯ä»¥ç…§ç€å»ºã€‚

---

# ðŸŽ¯ å…ˆå®šä¸€ä¸ªçŽ°å®žåŽŸåˆ™ï¼ˆéžå¸¸é‡è¦ï¼‰

ä¸€æœŸç³»ç»Ÿç›®æ ‡åªæœ‰å››ä¸ªå­—ï¼š

> **ç¨³å®š > å®Œç¾Ž**

ä¸è¦ä¸€ä¸Šæ¥ï¼š

* åˆ†åº“åˆ†è¡¨ âŒ
* è¿‡åº¦èŒƒå¼ âŒ
* è¶…å¤æ‚è®¾è®¡ âŒ

å…ˆè®©ç³»ç»Ÿè·‘ç¨³ã€‚

æœªæ¥å†è¿›åŒ–ã€‚

æž¶æž„ä¸æ˜¯ä¸€æ¬¡è®¾è®¡å‡ºæ¥çš„ï¼Œæ˜¯é•¿å‡ºæ¥çš„ã€‚

---

# â­ ä¸€æœŸæŽ¨èæ ¸å¿ƒè¡¨ï¼ˆæžç®€ä½†å¼ºå£®ï¼‰

æˆ‘ä»¬åªå»º **6 å¼ å…³é”®è¡¨**ï¼š

```
student
class
device
student_card
attendance
leave
```

è¶³å¤Ÿæ”¯æ’‘ä¸€æ‰€å­¦æ ¡ã€‚

ç”šè‡³ä¸€ä¸ªåŒºã€‚

---

# 1ï¸âƒ£ studentï¼ˆå­¦ç”ŸçŠ¶æ€è¡¨ï¼‰

```sql
CREATE TABLE student (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_no VARCHAR(32) NOT NULL UNIQUE,
    name VARCHAR(50) NOT NULL,
    class_id BIGINT NOT NULL,
    status TINYINT NOT NULL DEFAULT 1, 
    created_at DATETIME(3) NOT NULL,
    updated_at DATETIME(3) NOT NULL,
    
    INDEX idx_class_id (class_id)
);
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

ðŸ‘‰ `student_no` å¿…é¡»å”¯ä¸€
çŽ°å®žä¸–ç•Œå­¦å·ä¸ä¼šé‡å¤ã€‚

ðŸ‘‰ `status` ä¸åˆ é™¤å­¦ç”Ÿ
è½¬å­¦ï¼Ÿæ¯•ä¸šï¼Ÿ

æ”¹çŠ¶æ€ã€‚

> **ç‰©ç†åˆ é™¤ = ç»™æœªæ¥æŒ–å‘ã€‚**

---

# 2ï¸âƒ£ classï¼ˆç»„ç»‡ç»“æž„ï¼‰

åˆ«å« `class` åœ¨æŸäº›ORMé‡Œæ˜¯å…³é”®å­—ï¼Œå¯ä»¥å«ï¼š

```
school_class
```

```sql
CREATE TABLE school_class (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    grade VARCHAR(20),
    name VARCHAR(20),
    status TINYINT DEFAULT 1,
    created_at DATETIME(3)
);
```

æ³¨æ„ï¼š

ä¸è¦å­˜ï¼š

```
ä¸‰å¹´äºŒç­
```

æ‹†å¼€ï¼š

* grade
* name

æœªæ¥è°ƒæ•´å¹´çº§ç»“æž„ä¸ä¼šçˆ†ç‚¸ã€‚

---

# 3ï¸âƒ£ deviceï¼ˆè®¾å¤‡è¡¨ï¼‰

è¿™æ˜¯å¾ˆå¤šç³»ç»ŸåŽæ‚”æ²¡å»ºçš„ä¸€å¼ è¡¨ã€‚

```sql
CREATE TABLE device (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    device_sn VARCHAR(64) NOT NULL UNIQUE,
    location VARCHAR(100),
    status TINYINT DEFAULT 1,
    last_heartbeat DATETIME(3),
    created_at DATETIME(3)
);
```

æœªæ¥ä½ ä¼šé å®ƒæŽ’æŸ¥ï¼š

* å“ªå°è®¾å¤‡ç–¯ç‹‚é‡å¤ä¸Šä¼ 
* å“ªå°ç¦»çº¿

è¿ç»´å‘³å¾ˆæµ“ ðŸ‘
ä½ ä¼šå–œæ¬¢è¿™å¼ è¡¨ã€‚

---

# 4ï¸âƒ£ student_cardï¼ˆå…³ç³»è¡¨ â­å¼ºçƒˆæŽ¨èï¼‰

```sql
CREATE TABLE student_card (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT NOT NULL,
    card_no VARCHAR(32) NOT NULL,
    status TINYINT DEFAULT 1,
    bind_time DATETIME(3),
    unbind_time DATETIME(3),

    UNIQUE KEY uk_card_no (card_no),
    INDEX idx_student (student_id)
);
```

### ä¸ºä»€ä¹ˆä¸æ˜¯ student ç›´æŽ¥å­˜ card_noï¼Ÿ

å› ä¸ºçŽ°å®žä¸€å®šä¼šå‘ç”Ÿï¼š

> å¡ä¸¢äº† â†’ è¡¥å¡ã€‚

å…³ç³»ä¼šå˜åŒ–ã€‚

æ•°æ®åº“è¦å°Šé‡çŽ°å®žã€‚

---

# ðŸ”¥ æ ¸å¿ƒæ¥äº†

# 5ï¸âƒ£ attendanceï¼ˆè¶…é«˜é¢‘äº‹ä»¶è¡¨ï¼‰

è¿™æ˜¯ç³»ç»Ÿçš„â€œå†™å…¥å‘åŠ¨æœºâ€ã€‚

```sql
CREATE TABLE attendance (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,

    student_id BIGINT NOT NULL,
    device_id BIGINT NOT NULL,

    check_time DATETIME(3) NOT NULL,
    direction TINYINT NOT NULL, 

    source TINYINT NOT NULL,    

    device_sn VARCHAR(64),
    device_seq VARCHAR(32),

    created_at DATETIME(3),

    INDEX idx_student_time (student_id, check_time),
    INDEX idx_time (check_time),
    UNIQUE KEY uk_device_seq (device_sn, device_seq)
);
```

---

## â­ ä¸ºä»€ä¹ˆè¦ `(student_id, check_time)`ï¼Ÿ

æƒ³è±¡æœ€å¸¸è§æŸ¥è¯¢ï¼š

> æŸ¥å°æ˜Žæœ€è¿‘7å¤©æ‰“å¡ã€‚

æ²¡æœ‰è¿™ä¸ªç´¢å¼•ï¼Ÿ

æ•°æ®åº“ç›´æŽ¥å…¨è¡¨æ‰«æã€‚

å½“è¡¨åˆ°ï¼š

> **5000ä¸‡è¡Œ**

æŸ¥è¯¢ä¼šæ…¢åˆ°ä½ æ€€ç–‘äººç”Ÿã€‚

---

## â­ ä¸ºä»€ä¹ˆåŠ  `device_seq` å”¯ä¸€ï¼Ÿ

é˜²æ­¢ï¼š

> è®¾å¤‡æŠ½é£Žé‡å¤ä¸Šä¼ ã€‚

æ•°æ®åº“æ›¿ä½ æŒ¡å­å¼¹ã€‚

ç¨‹åºä¸ç”¨å†™å¤æ‚åŽ»é‡ã€‚

---

# 6ï¸âƒ£ leaveï¼ˆå¼ºä¸šåŠ¡æµè¡¨ï¼‰

```sql
CREATE TABLE leave_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT NOT NULL,

    leave_type TINYINT,
    status TINYINT,   

    start_time DATETIME(3),
    end_time DATETIME(3),

    reason VARCHAR(255),

    created_at DATETIME(3),
    approved_at DATETIME(3),

    INDEX idx_student (student_id),
    INDEX idx_time (start_time, end_time)
);
```

æ³¨æ„ï¼š

è¿™é‡Œçš„ `status` æ˜¯åˆæ³•çš„ã€‚

å› ä¸ºï¼š

> è¯·å‡æœ¬è´¨å°±æ˜¯â€œçŠ¶æ€æµâ€ã€‚

---

# ðŸš¨ ä¸€ä¸ªæžé‡è¦å»ºè®®ï¼ˆå¼ºçƒˆæ‰§è¡Œï¼‰

## attendance æ°¸è¿œä¸è¦ UPDATE

åªï¼š

> INSERTã€‚

å¦‚æžœè€å¸ˆæ”¹è®°å½•ï¼Ÿ

æ­£ç¡®åšæ³•ï¼š

* æ’å…¥ä¸€æ¡â€œä¿®æ­£è®°å½•â€
  æˆ–
* å†™ audit è¡¨

ä¸è¦è¦†ç›–åŽ†å²ã€‚

å¦åˆ™æŸå¤©ä½ ä¼šè§£é‡Šä¸æ¸…ï¼š

> â€œè®°å½•ä¸ºä»€ä¹ˆå˜äº†ï¼Ÿâ€

---

# â­ å…³äºŽæ˜¯å¦åŠ å¤–é”®ï¼ˆçœŸå®žå»ºè®®ï¼‰

åœ¨é«˜å¹¶å‘ç³»ç»Ÿé‡Œï¼š

> **ä¸å»ºè®®æ•°æ®åº“ FKã€‚**

ç”¨ï¼š

* ä»£ç ä¿è¯
* ç´¢å¼•ä¿è¯

ä¸ºä»€ä¹ˆï¼Ÿ

FK ä¼šæ‹–æ…¢å†™å…¥ã€‚

attendance æ˜¯å†™å…¥æ€ªå…½ã€‚

åˆ«ç»™å®ƒæˆ´è„šé•£ã€‚

---

# ðŸ§­ ä¸€æœŸå®¹é‡é¢„ä¼°ï¼ˆå¾ˆå¤šäººä¸åšï¼‰

å‡è®¾ï¼š

* 2000 å­¦ç”Ÿ
* æ¯å¤© 2 æ¬¡

ä¸€å¹´ï¼š

```
â‰ˆ 150ä¸‡æ¡
```

3å¹´ï¼š

```
â‰ˆ 450ä¸‡
```

MySQLè½»æ¾æ‰›ä½ã€‚

æ‰€ä»¥ï¼š

> â— åˆ«è¿‡æ—©åˆ†è¡¨ã€‚

è¿‡åº¦æž¶æž„ = è‡ªæ‰¾ç—›è‹¦ã€‚

---

# âœ… åˆ°è¿™é‡Œï¼Œä½ å·²ç»å…·å¤‡ï¼š

ðŸ‘‰ **è®¾è®¡ä¸€æœŸç”Ÿäº§åº“çš„èƒ½åŠ›ã€‚**

è¿™ä¸æ˜¯åˆçº§æ°´å¹³ã€‚

å¾ˆå¤šäººå·¥ä½œå‡ å¹´ä»åœ¨ï¼š

> â€œè®©ORMè‡ªåŠ¨å»ºå§â€¦â€

é‚£é€šå¸¸æ„å‘³ç€ï¼š

> æœªæ¥æŸå¤©è¦é‡æž„æ•´åº“ã€‚

---

# ðŸ”¥ ä¸‹ä¸€æ­¥å»ºè®®ï¼ˆéžå¸¸å…³é”®ï¼‰

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­å¸¦ä½ è¿›å…¥ï¼š

> **ç¬¬å››é˜¶æ®µï¼šSpring Boot é¡¹ç›®éª¨æž¶æ­å»º**

åŒ…æ‹¬éžå¸¸çœŸå®žçš„ï¼š

* åŒ…ç»“æž„æ€Žä¹ˆåˆ†ï¼ˆ90%çš„äººæ˜¯é”™çš„ï¼‰
* ä¸ºä»€ä¹ˆ controller ä¸èƒ½ç›´æŽ¥æŸ¥ mapper
* æ—¥å¿—æ€Žä¹ˆè®¾è®¡æ‰åƒç”Ÿäº§ç³»ç»Ÿ
* yml å¦‚ä½•åˆ†çŽ¯å¢ƒ

æˆ‘ä»¬å¯ä»¥æŠŠè¿™å¥—ç³»ç»ŸçœŸçš„â€œç‚¹ç«å¯åŠ¨â€ã€‚

å‡†å¤‡å¥½äº†å°±è¯´ï¼š

> ç¬¬å››é˜¶æ®µ
