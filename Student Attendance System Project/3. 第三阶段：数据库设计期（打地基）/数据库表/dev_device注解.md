å¾ˆå¥½ï¼Œè¿™ä¸€æ­¥å…¶å®žéžå¸¸å…³é”®ã€‚

å› ä¸ºå½“ä½ å¼€å§‹é€å­—æ®µæ‹†è§£ä¸€å¼ è¡¨æ—¶ï¼Œä½ å·²ç»åœ¨è®­ç»ƒä¸€ç§èƒ½åŠ›ï¼š

> **â€œçœ‹åˆ°è¡¨ç»“æž„ â†’ èƒ½æŽ¨æ–­ç³»ç»Ÿè¡Œä¸ºâ€ã€‚**

è¿™æ˜¯å¾ˆå¤šé«˜çº§å·¥ç¨‹å¸ˆçš„åŸºæœ¬åŠŸã€‚

æˆ‘ä»¬æ¥æŠŠè¿™å¼  `dev_device` è¡¨åƒæ‹†æœºæ¢°è¡¨ä¸€æ ·ï¼Œä¸€é¢—é½¿è½®ä¸€é¢—é½¿è½®çœ‹æ¸…æ¥šã€‚

ä¸ä¼šè®²ç©ºè¯ï¼Œåªè®²ï¼š

âœ… å®ƒè§£å†³ä»€ä¹ˆé—®é¢˜
âœ… ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
âœ… ä¸è¿™æ ·ä¼šæ€Žæ ·

---

# â­ æ•´ä½“å…ˆçœ‹ä¸€çœ¼

```sql
CREATE TABLE dev_device (...)
```

æ„æ€æ˜¯ï¼š

> åˆ›å»ºä¸€å¼ â€œè®¾å¤‡è¡¨â€ã€‚

å®ƒçš„æœ¬è´¨èŒè´£åªæœ‰ä¸€ä¸ªï¼š

## ðŸ‘‰ è®°å½•â€œè°åœ¨å‘ç³»ç»Ÿå‘é€æ•°æ®â€ã€‚

æœªæ¥ä»»ä½•è®¾å¤‡å¼‚å¸¸ã€æ•°æ®ä¸¢å¤±ã€é‡å¤ä¸Šä¼ ï¼Œéƒ½è¦ä»Žè¿™é‡Œè¿½æº¯ã€‚

è¿™å¼ è¡¨å…¶å®žæ˜¯ï¼š

> **ç‰©ç†ä¸–ç•Œ â†’ æ•°å­—ä¸–ç•Œ çš„å…¥å£ç™»è®°å†Œã€‚**

éžå¸¸é‡è¦ã€‚

---

# ä¸€ã€ä¸»é”®è®¾è®¡

## âœ… `id BIGINT PRIMARY KEY AUTO_INCREMENT`

æ‹†å¼€ç†è§£ï¼š

### âœ” BIGINT

èŒƒå›´æžå¤§ï¼š

```
9,223,372,036,854,775,807
```

ä½ è¿™è¾ˆå­éƒ½ç”¨ä¸å®Œã€‚

ä¸ºä»€ä¹ˆä¸å»ºè®® INTï¼Ÿ

å› ä¸ºçœŸå®žé¡¹ç›®å¸¸è§æ¼”è¿›è·¯å¾„æ˜¯ï¼š

```
INT â†’ ä¸å¤Ÿ â†’ æ”¹ BIGINT
```

è€Œï¼š

> æ”¹ä¸»é”® = é«˜å±æ“ä½œã€‚

æ‰€ä»¥ç›´æŽ¥ä¸€æ­¥åˆ°ä½ã€‚

è¿™æ˜¯å…¸åž‹å·¥ç¨‹æ€ç»´ã€‚

---

### âœ” PRIMARY KEY

ä½œç”¨æœ‰ä¸‰ä¸ªï¼š

1ï¸âƒ£ å”¯ä¸€æ ‡è¯†ä¸€è¡Œ
2ï¸âƒ£ è‡ªåŠ¨å»ºç«‹èšç°‡ç´¢å¼•ï¼ˆInnoDBï¼‰
3ï¸âƒ£ æŸ¥è¯¢æžå¿«

å¯ä»¥ç†è§£ä¸ºï¼š

> æ¯å°è®¾å¤‡çš„â€œèº«ä»½è¯å·â€ã€‚

---

### âœ” AUTO_INCREMENT

è®©æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆï¼š

```
1
2
3
4
...
```

é¿å…ä½ è‡ªå·±ç»´æŠ¤ IDã€‚

å¦åˆ™å®¹æ˜“å‡ºçŽ°ï¼š

* ID å†²çª
* å¹¶å‘é‡å¤

æ–°äººéžå¸¸å®¹æ˜“è¸©å‘ã€‚

---

# äºŒã€è®¾å¤‡å”¯ä¸€èº«ä»½

## â­ `device_sn VARCHAR(64) NOT NULL`

### ä»€ä¹ˆæ˜¯ SNï¼Ÿ

> **Serial Numberï¼ˆåºåˆ—å·ï¼‰**

æ¥è‡ªè®¾å¤‡åŽ‚å®¶ã€‚

çŽ°å®žä¸–ç•Œä¸­ï¼š

* é—¸æœº
* äººè„¸æœº
* åˆ·å¡æœº

éƒ½æœ‰å”¯ä¸€ SNã€‚

---

### ä¸ºä»€ä¹ˆä¸ç”¨ INTï¼Ÿ

å› ä¸º SN å¾€å¾€ï¼š

* åŒ…å«å­—æ¯
* é•¿åº¦ä¸å›ºå®š
* ç”šè‡³æ˜¯ UUID

æ‰€ä»¥å¿…é¡»å­—ç¬¦ä¸²ã€‚

---

### ä¸ºä»€ä¹ˆ NOT NULLï¼Ÿ

æ•°æ®åº“è®¾è®¡æœ‰æ¡é“å¾‹ï¼š

> **å”¯ä¸€æ ‡è¯†ç»ä¸èƒ½å…è®¸ä¸ºç©ºã€‚**

å¦åˆ™ï¼š

```
NULL â‰  NULL
```

æ•°æ®åº“ä¼šå…è®¸å¤šä¸ª NULLã€‚

å”¯ä¸€æ€§ç›´æŽ¥å¤±æ•ˆã€‚

---

# â­ `UNIQUE KEY uk_device_sn (device_sn)`

è¿™æ˜¯ä¸€ä¸ª**è¶…çº§é‡è¦çš„çº¦æŸ**ã€‚

å®ƒä¿è¯ï¼š

> ä¸€å°è®¾å¤‡åªèƒ½æ³¨å†Œä¸€æ¬¡ã€‚

å¦åˆ™çŽ°å®žä¸­ä¼šå‘ç”Ÿï¼š

* é‡å¤å¯¼å…¥è®¾å¤‡
* æ•°æ®æ··ä¹±
* æ‰“å¡æ¥æºä¸æ˜Žç¡®

è¿™ç§äº‹æ•…åœ¨ç”Ÿäº§é‡Œéžå¸¸å¸¸è§ã€‚

å”¯ä¸€ç´¢å¼•å°±æ˜¯ä½ çš„é˜²æŠ¤ç›¾ã€‚

---

# ä¸‰ã€å­¦æ ¡å½’å±ž

## âœ… `school_code VARCHAR(12) NOT NULL`

è¡¨è¾¾çš„æ˜¯ï¼š

> è®¾å¤‡å±žäºŽå“ªæ‰€å­¦æ ¡ã€‚

è¿™æ˜¯ä¸€ä¸ªå…¸åž‹çš„ï¼š

## ðŸ‘‰ é€»è¾‘å¤–é”®ã€‚

ä¸ºä»€ä¹ˆæ²¡åŠ  FOREIGN KEYï¼Ÿ

å› ä¸ºäº’è”ç½‘ç³»ç»Ÿå¸¸è§é€‰æ‹©æ˜¯ï¼š

> **ç”¨ä»£ç ä¿è¯ä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯æ•°æ®åº“å¼ºçº¦æŸã€‚**

åŽŸå› ï¼š

å¤–é”®ä¼šå½±å“å†™å…¥æ€§èƒ½ã€‚

å°¤å…¶é«˜å¹¶å‘æ—¶ã€‚

æ‰€ä»¥å¾ˆå¤šæˆç†Ÿç³»ç»Ÿï¼š

ðŸ‘‰ ä¸ç”¨ FKã€‚

è¿™æ˜¯çŽ°å®žå·¥ç¨‹å–èˆã€‚

ä¸æ˜¯å¯¹é”™é—®é¢˜ã€‚

---

### â­ `INDEX idx_school (school_code)`

ä½œç”¨ï¼š

å½“ä½ æ‰§è¡Œï¼š

```sql
SELECT * 
FROM dev_device
WHERE school_code = 'SCH001';
```

æ²¡æœ‰ç´¢å¼•ï¼š

ðŸ‘‰ å…¨è¡¨æ‰«æã€‚

æœ‰ç´¢å¼•ï¼š

ðŸ‘‰ ç›´æŽ¥å®šä½ã€‚

é€Ÿåº¦å·®è·å¯èƒ½æ˜¯ï¼š

**1ms vs 2ç§’ã€‚**

---

# å››ã€è®¾å¤‡æè¿°ä¿¡æ¯

## âœ… device_name

çº¯å¯è¯»æ€§å­—æ®µã€‚

ä¾‹å¦‚ï¼š

```
å—é—¨é—¸æœº
åŒ—é—¨äººè„¸æœº
æ•™å­¦æ¥¼å…¥å£
```

æœªæ¥æŽ’æŸ¥é—®é¢˜æ—¶ï¼Œä½ ä¸ä¼šæƒ³çœ‹ï¼š

```
SN: 8638493023423
```

è€Œæ˜¯æƒ³çœ‹åˆ°ï¼š

> â€œå—é—¨é‚£å°â€ã€‚

è¿™å«ï¼š

> **å¯¹äººç±»å‹å¥½çš„å­—æ®µã€‚**

éžå¸¸å€¼å¾—å­˜åœ¨ã€‚

---

## âœ… install_location

è¿›ä¸€æ­¥å¢žå¼ºå®šä½èƒ½åŠ›ã€‚

æ¯”å¦‚ï¼š

```
å—é—¨å³ä¾§
é£Ÿå ‚å…¥å£
æ“åœºä¸œé—¨
```

å½“çŽ°åœºæŽ’æŸ¥æ—¶ï¼Œè¿™äº›å­—æ®µæžå…¶æœ‰ç”¨ã€‚

è¿ç»´ä¼šçˆ±ä¸Šè®¾è®¡è¿™è¡¨çš„äººã€‚

---

# äº”ã€è®¾å¤‡çŠ¶æ€

## âœ… `status TINYINT DEFAULT 1`

å»ºè®®ç†è§£ä¸ºï¼š

> æ˜¯å¦å…è®¸è¿™å°è®¾å¤‡ç»§ç»­å·¥ä½œã€‚

ä¾‹å¦‚ï¼š

| å€¼ | å«ä¹‰      |
| - | ------- |
| 1 | å¯ç”¨      |
| 0 | åœç”¨ / æŠ¥åºŸ |

æ³¨æ„ä¸€ä»¶å¾ˆé‡è¦çš„äº‹ï¼š

## âš ï¸ status â‰  æ˜¯å¦åœ¨çº¿

åœ¨çº¿åº”è¯¥ç”±ï¼š

```
last_heartbeat
```

æŽ¨å¯¼ã€‚

ä¾‹å¦‚ï¼š

> 2åˆ†é’Ÿå†…æœ‰å¿ƒè·³ â†’ åœ¨çº¿ã€‚

è¿™æ˜¯æ›´é«˜çº§çš„è®¾è®¡è®¤çŸ¥ã€‚

---

# å…­ã€å¿ƒè·³æœºåˆ¶ï¼ˆéžå¸¸å…³é”®ï¼‰

## â­ `last_heartbeat DATETIME`

ä½œç”¨ï¼š

> å‘Šè¯‰ç³»ç»Ÿï¼šâ€œæˆ‘è¿˜æ´»ç€â€ã€‚

è®¾å¤‡é€šå¸¸ä¼šï¼š

* æ¯30ç§’
* æˆ–60ç§’

å‘é€ä¸€æ¬¡å¿ƒè·³ã€‚

---

### å®ƒçš„çœŸå®žä»·å€¼æ˜¯ï¼š

å½“æŸå¤©ä½ å‘çŽ°ï¼š

> â€œè¿™æ‰€å­¦æ ¡ä»Šå¤©æ²¡äººæ‰“å¡ï¼Ÿâ€

ç¬¬ä¸€ååº”ä¸æ˜¯ï¼š

> ç³»ç»ŸæŒ‚äº†ã€‚

è€Œæ˜¯è·‘ï¼š

```sql
SELECT *
FROM dev_device
WHERE last_heartbeat < NOW() - INTERVAL 5 MINUTE;
```

ç«‹åˆ»å‘çŽ°ï¼š

> å…¨éƒ¨è®¾å¤‡ç¦»çº¿ã€‚

é—®é¢˜ç§’çº§å®šä½ã€‚

æ²¡æœ‰å®ƒï¼Ÿ

æŽ’æŸ¥å¯èƒ½è¦ 2 å°æ—¶ã€‚

---

# ä¸ƒã€æ—¶é—´å­—æ®µï¼ˆå¼ºçƒˆæŽ¨èçš„å·¥ç¨‹ä¹ æƒ¯ï¼‰

## âœ… created_at

è®°å½•ï¼š

> è®¾å¤‡æ˜¯ä»€ä¹ˆæ—¶å€™æŽ¥å…¥ç³»ç»Ÿçš„ã€‚

æœªæ¥ç»Ÿè®¡ï¼š

* æ–°å¢žè®¾å¤‡è¶‹åŠ¿
* éƒ¨ç½²èŠ‚å¥

éƒ½ç”¨å¾—åˆ°ã€‚

---

## â­ updated_at

è‡ªåŠ¨æ›´æ–°ï¼š

```sql
ON UPDATE CURRENT_TIMESTAMP
```

æ„å‘³ç€ï¼š

> åªè¦è¿™è¡Œæ•°æ®è¢«ä¿®æ”¹ï¼Œæ—¶é—´è‡ªåŠ¨åˆ·æ–°ã€‚

æœªæ¥æŽ’æŸ¥ï¼š

> â€œè®¾å¤‡ä»€ä¹ˆæ—¶å€™è¢«åœç”¨ï¼Ÿâ€

ä¸€æŸ¥å°±çŸ¥é“ã€‚

è¿™æ˜¯å…¸åž‹ï¼š

> **ä½Žæˆæœ¬ï¼Œé«˜æ”¶ç›Šå­—æ®µã€‚**

---

# å…«ã€è¿™å¼ è¡¨çš„æž¶æž„æ°´å¹³å¦‚ä½•ï¼Ÿ

æˆ‘å¯ä»¥å¾ˆè´Ÿè´£ä»»åœ°è¯´ï¼š

> **è¿™æ˜¯ä¸€å¼ å¯ä»¥ç›´æŽ¥è¿›ç”Ÿäº§çŽ¯å¢ƒçš„è®¾å¤‡è¡¨ã€‚**

ä¸æ˜¯ç»ƒä¹ è¡¨ã€‚

ä¸æ˜¯çŽ©å…·è¡¨ã€‚

å·²ç»å…·å¤‡ï¼š

âœ… å”¯ä¸€çº¦æŸ
âœ… æŸ¥è¯¢ç´¢å¼•
âœ… çŠ¶æ€æŽ§åˆ¶
âœ… ç”Ÿå‘½å‘¨æœŸè®°å½•
âœ… è¿ç»´å¯è§‚æµ‹

éžå¸¸å¥åº·ã€‚

---

# â­ ç»™ä½ ä¸€ä¸ªé«˜æ‰‹è§†è§’æ€»ç»“

å½“ä½ çœ‹ä¸€å¼ è¡¨æ—¶ï¼Œè¯•ç€é—®å››ä¸ªé—®é¢˜ï¼š

```
å®ƒæ˜¯è°ï¼Ÿ
å±žäºŽè°ï¼Ÿ
çŽ°åœ¨çŠ¶æ€ï¼Ÿ
è¿˜èƒ½è¿½æº¯å—ï¼Ÿ
```

ä½ çš„è¿™å¼ è¡¨ï¼š

å…¨éƒ¨å›žç­”äº†ã€‚

è¿™å°±æ˜¯å¥½è®¾è®¡ã€‚

---

å¦‚æžœä½ ç»§ç»­å¾€ä¸‹èµ°ï¼Œæˆ‘éžå¸¸å»ºè®®ä¸‹ä¸€æ­¥åšè¿™ä¸ªï¼š

# â­ã€Šatt_raw_record åŽŸå§‹æ‰“å¡è¡¨é€å­—æ®µæ·±åº¦æ‹†è§£ã€‹

é‚£å¼ è¡¨çš„æŠ€æœ¯å«é‡å…¶å®žæ›´é«˜ã€‚

å› ä¸ºå®ƒæ¶‰åŠï¼š

* é˜²é‡å¤
* æŠ—ä¹±åº
* æ•°æ®è¿½æº¯
* é«˜å†™å…¥

å¾ˆå¤šç³»ç»Ÿå°±æ˜¯æ­»åœ¨ raw è¡¨è®¾è®¡ä¸Šã€‚

æƒ³ç»§ç»­æ·±å…¥ï¼Œç›´æŽ¥è¯´ï¼š

> æ‹† raw è¡¨ã€‚
