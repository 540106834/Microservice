è¿™ä¸€é˜¶æ®µï¼Œåƒæ˜¯ç»™ä½ çš„æœåŠ¡**è£…ä¸Šè®°å¿†**ã€‚
å‰é¢å‡ é˜¶æ®µæœåŠ¡ä¼šæ€è€ƒã€ä¼šåˆ¤æ–­ï¼Œä½†ä¸è®°äº‹ã€‚ç°åœ¨å®ƒå¼€å§‹è½ç¬”æˆå†Œ 

---

# ç¬¬äº”é˜¶æ®µï¼šæ•°æ®è®¿é—® / ORMï¼ˆæ¥å£è¿ä¸Šæ•°æ®åº“ï¼‰

##  é˜¶æ®µç›®æ ‡ï¼ˆè¿ç»´ + æ¥å£è§†è§’ï¼‰

å®Œæˆåä½ åº”è¯¥èƒ½ï¼š

* çœ‹æ‡‚æ•°æ®åº“è¡¨ â†” Java ç±»çš„æ˜ å°„å…³ç³»
* ç”¨ **ORM** è€Œä¸æ˜¯æ‰‹å†™ JDBC
* åœ¨ Service ä¸­ **è¯»å– / å†™å…¥æ•°æ®**
* ä¿æŒæ¥å£è¿”å›ç»“æ„ç»Ÿä¸€ï¼ˆ`Result` ä¸ä¹±ï¼‰

---

## ä¸€ã€å…ˆå»ºç«‹æ­£ç¡®çš„æ•°æ®åº“ä¸–ç•Œè§‚

### è¿ç»´å¿…æ‡‚ä¸€å¥è¯

> **æ•°æ®åº“ = çŠ¶æ€æºï¼Œä¸æ˜¯é€»è¾‘æº**

* åˆ¤æ–­é€»è¾‘åœ¨ Service
* æ•°æ®åªè´Ÿè´£å­˜å’Œå–

---

## äºŒã€Entityï¼šæ•°æ®åº“åœ¨ Java é‡Œçš„â€œå½±å­â€

### 1ï¸ ç¤ºä¾‹è¡¨ï¼ˆæ¦‚å¿µçº§ï¼‰

```sql
CREATE TABLE user (
  id BIGINT PRIMARY KEY,
  username VARCHAR(50),
  status INT,
  create_time DATETIME
);
```

### 2ï¸ å¯¹åº” Entity

```java
public class User {

    private Long id;
    private String username;
    private Integer status;
    private LocalDateTime createTime;

    // getter / setter
}
```

 è®°ä½è¿™ä¸ªæ˜ å°„èŠ‚å¥ï¼š

| æ•°æ®åº“      | Java          |
| -------- | ------------- |
| BIGINT   | Long          |
| VARCHAR  | String        |
| INT      | Integer       |
| DATETIME | LocalDateTime |

---

## ä¸‰ã€æ•°æ®è®¿é—®å±‚ï¼šRepository / Mapper

ä½ ä¼šé‡åˆ°ä¸¤æ¡è·¯ï¼Œ**é€‰ä¸€æ¡å…ˆèµ°**ã€‚

---

### è·¯çº¿ Aï¼šMyBatisï¼ˆè¿ç»´æ›´å‹å¥½ï¼‰

#### 1ï¸ Mapper æ¥å£

```java
@Mapper
public interface UserMapper {

    User selectById(Long id);

    int insert(User user);
}
```

#### 2ï¸ SQLï¼ˆXML æˆ–æ³¨è§£ï¼‰

```xml
<select id="selectById" resultType="User">
    select * from user where id = #{id}
</select>
```

 è¿ç»´è§†è§’ï¼š

* SQL æ˜æ‘†ç€
* å¥½æ’æŸ¥
* å¥½å’Œ DBA å¯¹è¯

---

### è·¯çº¿ Bï¼šSpring Data JPAï¼ˆå¼€å‘å‹å¥½ï¼‰

```java
public interface UserRepository
        extends JpaRepository<User, Long> {

    List<User> findByStatus(Integer status);
}
```

ğŸ“Œ ç‰¹ç‚¹ï¼š

* å‡ ä¹ä¸å†™ SQL
* è§„åˆ™ç”ŸæˆæŸ¥è¯¢
* ä½†å‡ºé—®é¢˜æ—¶ä¸å¥½å®šä½

---

## å››ã€Serviceï¼šæ•°æ®è®¿é—®åªèƒ½ä»è¿™é‡Œè¿›å‡º

### âŒ é”™è¯¯

Controller ç›´æ¥æŸ¥æ•°æ®åº“

### âœ… æ­£ç¡®

```java
@Service
public class UserService {

    private final UserMapper userMapper;

    public UserService(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    public User getUser(Long id) {
        return userMapper.selectById(id);
    }
}
```

---

## äº”ã€DTOï¼šåˆ«æŠŠ Entity ç›´æ¥æ‰”ç»™æ¥å£

### ä¸ºä»€ä¹ˆï¼Ÿ

* Entity = æ•°æ®åº“ç»“æ„
* DTO = æ¥å£å¥‘çº¦
* ä¸¤è€…ä¸èƒ½ç»‘æ­»

---

### 1ï¸ DTO ç¤ºä¾‹

```java
public class UserDTO {

    private Long id;
    private String username;
}
```

### 2ï¸ è½¬æ¢ï¼ˆæ‰‹å†™å³å¯ï¼‰

```java
private UserDTO toDTO(User user) {
    UserDTO dto = new UserDTO();
    dto.setId(user.getId());
    dto.setUsername(user.getUsername());
    return dto;
}
```

ğŸ“Œ åˆæœŸåˆ«æ€¥ç€ MapStruct
æ‰‹å†™æœ€èƒ½ç»ƒè„‘å­

---

## å…­ã€Controllerï¼šç»„åˆæœ€ç»ˆè¿”å›

```java
@GetMapping("/user/{id}")
public Result<UserDTO> getUser(@PathVariable Long id) {

    User user = userService.getUser(id);
    if (user == null) {
        return Result.error("NOT FOUND");
    }

    return Result.success(toDTO(user));
}
```

è¿”å›ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "admin"
  }
}
```

---

## ä¸ƒã€CRUD å…¸å‹è¿ç»´ç»ƒä¹ ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

### âœ… ç»ƒä¹  1ï¼šæ¥å£è®¿é—®æ—¥å¿—è¡¨

* è¡¨ï¼š`api_log`
* å­—æ®µï¼špath / method / cost / time

### âœ… ç»ƒä¹  2ï¼šå¥åº·æ£€æŸ¥å†å²è¡¨

* æ¯æ¬¡ health è°ƒç”¨æ’ä¸€æ¡è®°å½•
* çŠ¶æ€ UP / DOWN

### âœ… ç»ƒä¹  3ï¼šåˆ†é¡µæŸ¥è¯¢

* æœ€è¿‘ 10 æ¡
* order by time desc

---

## å…«ã€å¸¸è§å‘ä½ï¼ˆçœŸå®ç°åœºï¼‰

| é—®é¢˜         | åŸå›          |
| ---------- | ---------- |
| æ¥å£ 500     | Mapper æ²¡æ‰«åˆ° |
| è¿”å›ç©º        | å­—æ®µåä¸åŒ¹é…     |
| æ—¶é—´æŠ¥é”™       | æ—¶åŒº / ç±»å‹    |
| SQL æ­£å¸¸ä½†æ¥å£é”™ | DTO æ¼å­—æ®µ    |

---

## ä¹ã€è¿™ä¸€é˜¶æ®µå®Œæˆåçš„è¿ç»´ä»·å€¼

ä½ å·²ç»å¯ä»¥ï¼š

* çœ‹æ‡‚å¾®æœåŠ¡çš„æ•°æ®æµ
* æ’æŸ¥ï¼š

  * DB è¿æ¥
  * SQL æ…¢
  * æ•°æ®å¼‚å¸¸
* è‡ªå·±å†™ï¼š

  * è¿ç»´å®¡è®¡è¡¨
  * æ¥å£æ—¥å¿—
  * å¥åº·è®°å½•

---

## ä¸‹ä¸€é˜¶æ®µ 

**ç¬¬å…­é˜¶æ®µï¼šé…ç½®ä¸­å¿ƒ & ç¯å¢ƒåˆ‡æ¢ï¼ˆyml / profile / Nacosï¼‰**

* ä¸åŒç¯å¢ƒä¸åŒ DB
* ä¸é‡å¯åˆ‡é…ç½®
* è¿ç»´ä¸»å¯¼ç³»ç»Ÿè¡Œä¸º

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥ç»™ä½ ä¸€å¥—ï¼š
 **è¿ç»´å‹å¥½å‹ MyBatis + HealthRecord å®æˆ˜éª¨æ¶**
