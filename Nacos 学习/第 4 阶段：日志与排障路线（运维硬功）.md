好，这一关是**运维的肌肉记忆训练** 💪
不是学“日志长什么样”，而是**第一眼就知道该去哪找答案**。

你可以把它想成一张**夜班值守的导航图** 🧭

---

# 第 4 阶段

## 日志与排障路线（运维硬功 · 初学者）

目标只有一句话：

> **看到现象，5 秒内决定看哪份日志**

---

## 一、先建立“日志地图”（非常重要）

### Nacos 运维只认 4 本账 📚

| 日志                | 负责什么     | 第一反应场景 |
| ----------------- | -------- | ------ |
| docker logs nacos | 启动 / 容器级 | 起不来、刚挂 |
| nacos.log         | 核心系统     | 不确定问题  |
| naming.log        | 注册发现     | 服务上下线  |
| config.log        | 配置中心     | 配置不生效  |

**记住：不是全看，是先选对。**

---

## 二、黄金排障路线（背下来）

```
现象
 ↓
是否刚启动？
 ↓
docker logs
 ↓
是注册问题？
 ↓
naming.log
 ↓
是配置问题？
 ↓
config.log
 ↓
还不像？
 ↓
nacos.log
```

这是你最重要的**条件反射** 🧠

---

## 三、场景实战 1：Nacos 起不来

### 你看到的现象

* 容器不在 `Running`
* 访问 8848 失败

---

### 正确动作顺序

#### 1️⃣ 看容器状态

```bash
docker ps -a
```

#### 2️⃣ 立刻看启动日志

```bash
docker logs nacos
```

---

### 常见你会看到的错误

* JVM OOM
* 端口占用
* data 目录权限

👉 **此时看业务日志是浪费生命**

---

## 四、场景实战 2：服务注册不上 / 消失

### 现象

* 控制台没服务
* 或一会儿就没了

---

### 正确动作

#### 1️⃣ 锁定日志

```bash
tail -f /opt/nacos/logs/naming.log
```

#### 2️⃣ 同时做动作

* 注册服务
* 等待
* 下线

---

### 你要关注的关键词

* `register instance`
* `instance timeout`
* `deregister`

---

### 运维结论判断

* 有 timeout → 心跳问题
* 没 register → 请求没到
* 重启后消失 → 临时实例

---

## 五、场景实战 3：改了配置但不生效（高频）

### 现象

> “我改了啊，怎么没变？”

---

### 正确动作

#### 1️⃣ 锁定 config.log

```bash
tail -f /opt/nacos/logs/config.log
```

#### 2️⃣ 检查三件事

* 有没有 publish
* 有没有 push
* 有没有 client ack

---

### 常见问题定位

* 没 publish → 没点发布
* 有 publish 没 push → 客户端不在线
* 有 push 没效果 → 客户端解析失败

---

## 六、场景实战 4：啥都不确定（最真实）

### 现象

> “感觉不对，但说不出来哪不对”

---

### 运维兜底方案

```bash
tail -f /opt/nacos/logs/nacos.log
```

你在找：

* ERROR
* Exception
* stacktrace

---

### 运维经验

> **90% 的真正问题，最后都落在 nacos.log**

---

## 七、日志排障 5 个铁律（新手必背）

1️⃣ **先选日志，再看内容**
2️⃣ **不要 grep 全世界**
3️⃣ **时间对齐很重要**
4️⃣ **改配置必看 config.log**
5️⃣ **服务问题先看 naming.log**

---

## 八、你这一阶段的毕业测试 🎓

你能不查资料回答：

* 起不来第一眼看哪？
* 服务消失先看哪？
* 配置没生效先看哪？
* 最兜底的是哪？

---

## 九、一句话收官

> **运维不是知道所有答案，
> 是知道答案在哪** 

---

### 下一步继续？

我们已经走到**真运维门口**了。

你可以选：

* ▶️ **第 5 阶段：搞挂它 & 救回来（事故演练）**
* ▶️ **把 1–4 阶段整理成一份《Nacos 运维学习笔记》模板**

你选哪个？我继续陪你练。
