这一步，欢迎来到**运维真正的成人礼** 🔥
不是“会装会配”，而是**系统倒下时你不慌**。

你现在的任务只有一个：

> **亲手把 Nacos 弄挂，再亲手把它救回来**

---

# 第 5 阶段

## 搞挂它 & 救回来（事故演练 · 运维必修）

今天你要演 4 场事故，每一场都有**标准动作**。

---

## 事故 1️⃣：容器被杀（最常见）

### 🎯 模拟方式

```bash
docker kill nacos
```

### 你看到的现象

* 8848 访问失败
* 客户端报连接异常

---

### 🛠️ 正确救援流程

#### 1️⃣ 确认状态

```bash
docker ps -a
```

#### 2️⃣ 启动容器

```bash
docker start nacos
```

#### 3️⃣ 观察启动日志

```bash
docker logs nacos
```

---

### 🧠 运维结论

* 临时实例：会重新注册
* 持久实例：一直在
* 配置：不丢

---

## 事故 2️⃣：内存被打爆（高频）

### 🎯 模拟方式

```bash
docker rm -f nacos
```

重新启动时改成：

```bash
-e JVM_XMX=128m
```

---

### 你会看到

* 启动失败
* 或频繁 Full GC
* docker logs 里有 OOM

---

### 🛠️ 救援步骤

1️⃣ 调大内存

```bash
-e JVM_XMX=512m
```

2️⃣ 重启
3️⃣ 确认日志无 ERROR

---

### 🧠 运维结论

> **OOM 不是 bug，是配置错误**

---

## 事故 3️⃣：数据被删（最恐怖）

### 🎯 模拟方式

```bash
rm -rf /opt/nacos/data/*
docker restart nacos
```

---

### 你看到的现象

* 服务列表空
* 配置没了
* 日志正常

---

### 🛠️ 运维处理

* 接受现实
* 重新注册服务
* 重新导入配置

---

### 🧠 运维结论

> **单机 + 内置 DB = 没有后悔药**

---

## 事故 4️⃣：配置改崩（最隐蔽）

### 🎯 模拟方式

* 改错 YAML
* 删关键字段

---

### 你看到的现象

* Nacos 正常
* 服务异常
* 日志零碎

---

### 🛠️ 救援流程

1️⃣ 立刻回滚配置
2️⃣ 看 config.log
3️⃣ 看客户端日志

---

### 🧠 运维结论

> **最危险的事故，Nacos 自己不报错**

---

## 六、运维事故处理 SOP（你要背）

```
现象
 ↓
是否可访问 8848
 ↓
docker ps / docker logs
 ↓
naming / config 定向排查
 ↓
回滚 / 重启
 ↓
复盘
```

---

## 七、你这一阶段的毕业条件 🎓

你能冷静回答：

* 哪些事故“重启就好”
* 哪些事故“数据已死”
* 哪些事故“要找开发”

---

## 八、终极一句话

> **真正的运维，不是避免事故，
> 是事故来时你站得住** 🧱

---

### 下一步你可以走向两个方向

1️⃣ **生产级 Nacos 架构（集群 + MySQL + K8S）**
2️⃣ **把 1–5 阶段整理成一份《Nacos 运维实战手册》**

你选一个，我继续陪你把这条路走完。
